<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>5. Web services &mdash; deegree webservices ${project.version} documentation</title>
    
    <link rel="stylesheet" href="_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-3.2.0/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-3.2.0/css/bootstrap-theme.min.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-sphinx.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '${project.version}',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="_static/bootstrap-3.2.0/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="deegree webservices ${project.version} documentation" href="index.html" />
    <link rel="next" title="6. Feature stores" href="featurestores.html" />
    <link rel="prev" title="4. Configuration basics" href="basics.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="index.html">
          deegree webservices</a>
        <span class="navbar-text navbar-version pull-left"><b>${project.version}</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="intro.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">2. Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="lightly.html">3. Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="basics.html">4. Configuration basics</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="">5. Web services</a></li>
<li class="toctree-l1"><a class="reference internal" href="featurestores.html">6. Feature stores</a></li>
<li class="toctree-l1"><a class="reference internal" href="tilestores.html">7. Tile stores</a></li>
<li class="toctree-l1"><a class="reference internal" href="coveragestores.html">8. Coverage stores</a></li>
<li class="toctree-l1"><a class="reference internal" href="metadatastores.html">9. Metadata stores</a></li>
<li class="toctree-l1"><a class="reference internal" href="layers.html">10. Map layers</a></li>
<li class="toctree-l1"><a class="reference internal" href="themes.html">11. Map themes</a></li>
<li class="toctree-l1"><a class="reference internal" href="renderstyles.html">12. Map styles</a></li>
<li class="toctree-l1"><a class="reference internal" href="filterencoding.html">13. Filter Encoding</a></li>
<li class="toctree-l1"><a class="reference internal" href="serverconnections.html">14. Server connections</a></li>
<li class="toctree-l1"><a class="reference internal" href="processproviders.html">15. Process providers</a></li>
<li class="toctree-l1"><a class="reference internal" href="crs.html">16. Coordinate reference systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="restapi.html">17. deegree REST interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="javamodules.html">18. Java modules and libraries</a></li>
<li class="toctree-l1"><a class="reference internal" href="gdal.html">19. GDAL components</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">5. Web services</a><ul>
<li><a class="reference internal" href="#web-feature-service-wfs">5.1. Web Feature Service (WFS)</a><ul>
<li><a class="reference internal" href="#minimal-example">5.1.1. Minimal example</a></li>
<li><a class="reference internal" href="#more-complex-example">5.1.2. More complex example</a></li>
<li><a class="reference internal" href="#configuration-overview">5.1.3. Configuration overview</a></li>
<li><a class="reference internal" href="#general-options">5.1.4. General options</a></li>
<li><a class="reference internal" href="#transactions">5.1.5. Transactions</a></li>
<li><a class="reference internal" href="#adapting-gml-output-formats">5.1.6. Adapting GML output formats</a><ul>
<li><a class="reference internal" href="#basic-gml-format-options">5.1.6.1. Basic GML format options</a></li>
<li><a class="reference internal" href="#getfeature-response-settings">5.1.6.2. GetFeature response settings</a></li>
<li><a class="reference internal" href="#coordinate-formatters">5.1.6.3. Coordinate formatters</a></li>
<li><a class="reference internal" href="#geometry-linearization">5.1.6.4. Geometry linearization</a></li>
</ul>
</li>
<li><a class="reference internal" href="#adding-custom-output-formats">5.1.7. Adding custom output formats</a></li>
<li><a class="reference internal" href="#stored-queries">5.1.8. Stored queries</a></li>
</ul>
</li>
<li><a class="reference internal" href="#web-map-service-wms">5.2. Web Map Service (WMS)</a><ul>
<li><a class="reference internal" href="#a-word-on-layers-and-themes">5.2.1. A word on layers and themes</a></li>
<li><a class="reference internal" href="#id1">5.2.2. Configuration overview</a></li>
<li><a class="reference internal" href="#basic-options">5.2.3. Basic options</a></li>
<li><a class="reference internal" href="#service-content-configuration">5.2.4. Service content configuration</a></li>
<li><a class="reference internal" href="#custom-feature-info-formats">5.2.5. Custom feature info formats</a></li>
<li><a class="reference internal" href="#featureinfo-templating-format">5.2.6. FeatureInfo templating format</a><ul>
<li><a class="reference internal" href="#introduction-example">5.2.6.1. Introduction/Example</a></li>
<li><a class="reference internal" href="#templating-special-constructs">5.2.6.2. Templating special constructs</a></li>
</ul>
</li>
<li><a class="reference internal" href="#extended-capabilities">5.2.7. Extended capabilities</a></li>
<li><a class="reference internal" href="#vendor-specific-parameters">5.2.8. Vendor specific parameters</a></li>
</ul>
</li>
<li><a class="reference internal" href="#web-map-tile-service-wmts">5.3. Web Map Tile Service (WMTS)</a><ul>
<li><a class="reference internal" href="#id2">5.3.1. Minimal example</a></li>
<li><a class="reference internal" href="#id3">5.3.2. More complex example</a></li>
<li><a class="reference internal" href="#id4">5.3.3. Configuration overview</a></li>
</ul>
</li>
<li><a class="reference internal" href="#catalogue-service-for-the-web-csw">5.4. Catalogue Service for the Web (CSW)</a><ul>
<li><a class="reference internal" href="#id5">5.4.1. Minimal example</a></li>
<li><a class="reference internal" href="#id6">5.4.2. Configuration overview</a></li>
<li><a class="reference internal" href="#extended-functionality">5.4.3. Extended Functionality</a></li>
</ul>
</li>
<li><a class="reference internal" href="#web-processing-service-wps">5.5. Web Processing Service (WPS)</a><ul>
<li><a class="reference internal" href="#id7">5.5.1. Minimal example</a></li>
<li><a class="reference internal" href="#complex-example">5.5.2. Complex example</a></li>
<li><a class="reference internal" href="#id8">5.5.3. Configuration overview</a></li>
<li><a class="reference internal" href="#defaultexecutionmanager-section">5.5.4. DefaultExecutionManager section</a></li>
</ul>
</li>
<li><a class="reference internal" href="#metadata">5.6. Metadata</a><ul>
<li><a class="reference internal" href="#service-identification">5.6.1. Service identification</a></li>
<li><a class="reference internal" href="#service-provider">5.6.2. Service provider</a></li>
<li><a class="reference internal" href="#dataset-metadata">5.6.3. Dataset metadata</a></li>
<li><a class="reference internal" href="#id11">5.6.4. Extended capabilities</a></li>
</ul>
</li>
<li><a class="reference internal" href="#service-controller">5.7. Service controller</a><ul>
<li><a class="reference internal" href="#reported-urls">5.7.1. Reported URLs</a></li>
<li><a class="reference internal" href="#request-timeouts">5.7.2. Request timeouts</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="basics.html" title="Previous Chapter: 4. Configuration basics"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; 4. Configuration...</span>
    </a>
  </li>
  <li>
    <a href="featurestores.html" title="Next Chapter: 6. Feature stores"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">6. Feature store... &raquo;</span>
    </a>
  </li>
              
            
            
            
            
              <li class="hidden-sm">
<div id="sourcelink">
  <a href="_sources/webservices.txt"
     rel="nofollow">Source</a>
</div></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12">
      
  <div class="section" id="web-services">
<span id="anchor-configuration-service"></span><h1>5. Web services<a class="headerlink" href="#web-services" title="Permalink to this headline">¶</a></h1>
<p>This chapter describes the configuration of web service resources. You can access this configuration level by clicking the <strong>web services</strong> link in the administration console. The corresponding configuration files are located in the <tt class="docutils literal"><span class="pre">services/</span></tt> subdirectory of the active deegree workspace directory.</p>
<div class="figure" style="width: 80%">
<a class="reference external image-reference" href="_images/workspace-overview-services.png"><img alt="_images/workspace-overview-services.png" src="_images/workspace-overview-services.png" style="width: 80%;" /></a>
<p class="caption">Web services are the top-level resources of the deegree workspace</p>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">The identifier of a web service resource has a special purpose. If your deegree instance can be reached at <tt class="docutils literal"><span class="pre">http://localhost:8080/deegree-webservices</span></tt>, the common endpoint for connecting to your services is <tt class="docutils literal"><span class="pre">http://localhost:8080/deegree-webservices/services</span></tt>. However, if you define multiple service resources of the same type in your workspace (e.g. two WMS instances with identifiers <tt class="docutils literal"><span class="pre">wms1</span></tt> and <tt class="docutils literal"><span class="pre">wms2</span></tt>), you cannot use the common URL, as deegree cannot determine the targeted WMS instance from the request. In this case, simply append the resource identifier to the common endpoint URL (e.g. <tt class="docutils literal"><span class="pre">http://localhost:8080/deegree-webservices/services/wms2</span></tt>) to choose the service resource that you want to connect to explicitly.</p>
</div>
<div class="section" id="web-feature-service-wfs">
<span id="anchor-configuration-wfs"></span><h2>5.1. Web Feature Service (WFS)<a class="headerlink" href="#web-feature-service-wfs" title="Permalink to this headline">¶</a></h2>
<p>A deegree WFS setup consists of a WFS configuration file and any number of feature store configuration files. Feature stores provide access to the actual data (which may be stored in any of the supported backends, e.g. in shapefiles or spatial databases such as PostGIS or Oracle Spatial). In transactional mode (WFS-T), feature stores are also used for modification of stored features:</p>
<div class="figure" style="width: 80%">
<a class="reference external image-reference" href="_images/workspace-wfs.png"><img alt="_images/workspace-wfs.png" src="_images/workspace-wfs.png" style="width: 80%;" /></a>
<p class="caption">A WFS resource is connected to any number of feature store resources</p>
</div>
<div class="section" id="minimal-example">
<h3>5.1.1. Minimal example<a class="headerlink" href="#minimal-example" title="Permalink to this headline">¶</a></h3>
<p>The only mandatory option is <tt class="docutils literal"><span class="pre">QueryCRS</span></tt>, therefore, a minimal WFS configuration example looks like this:</p>
<div class="topic">
<p class="topic-title first">WFS config example 1: Minimal configuration</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;deegreeWFS</span> <span class="na">configVersion=</span><span class="s">&quot;3.4.0&quot;</span>
  <span class="na">xmlns=</span><span class="s">&quot;http://www.deegree.org/services/wfs&quot;</span>
  <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
  <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://www.deegree.org/services/wfs</span>
<span class="s">  http://schemas.deegree.org/services/wfs/3.4.0/wfs_configuration.xsd&quot;</span><span class="nt">&gt;</span>
  
  <span class="nt">&lt;QueryCRS&gt;</span>urn:ogc:def:crs:EPSG::4258<span class="nt">&lt;/QueryCRS&gt;</span>

<span class="nt">&lt;/deegreeWFS&gt;</span>
</pre></div>
</div>
</div>
<p>This will create a deegree WFS with the feature types from all configured feature stores in the workspace and <tt class="docutils literal"><span class="pre">urn:ogc:def:crs:EPSG::4258</span></tt> as coordinate system for returned GML geometries.</p>
</div>
<div class="section" id="more-complex-example">
<h3>5.1.2. More complex example<a class="headerlink" href="#more-complex-example" title="Permalink to this headline">¶</a></h3>
<p>A more complex configuration example looks like this:</p>
<div class="topic">
<p class="topic-title first">WFS config example 2: More complex configuration</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;deegreeWFS</span> <span class="na">configVersion=</span><span class="s">&quot;3.4.0&quot;</span>
  <span class="na">xmlns=</span><span class="s">&quot;http://www.deegree.org/services/wfs&quot;</span>
  <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
  <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://www.deegree.org/services/wfs</span>
<span class="s">  http://schemas.deegree.org/services/wfs/3.4.0/wfs_configuration.xsd&quot;</span><span class="nt">&gt;</span>

  <span class="nt">&lt;SupportedVersions&gt;</span>
    <span class="nt">&lt;Version&gt;</span>2.0.0<span class="nt">&lt;/Version&gt;</span>
    <span class="nt">&lt;Version&gt;</span>1.1.0<span class="nt">&lt;/Version&gt;</span>
  <span class="nt">&lt;/SupportedVersions&gt;</span>

  <span class="nt">&lt;FeatureStoreId&gt;</span>inspire-ad<span class="nt">&lt;/FeatureStoreId&gt;</span>

  <span class="nt">&lt;EnableTransactions</span> <span class="na">idGen=</span><span class="s">&quot;UseExisting&quot;</span><span class="nt">&gt;</span>true<span class="nt">&lt;/EnableTransactions&gt;</span>
  <span class="nt">&lt;EnableResponseBuffering&gt;</span>false<span class="nt">&lt;/EnableResponseBuffering&gt;</span>

  <span class="nt">&lt;QueryCRS&gt;</span>urn:ogc:def:crs:EPSG::4258<span class="nt">&lt;/QueryCRS&gt;</span>
  <span class="nt">&lt;QueryCRS&gt;</span>urn:ogc:def:crs:EPSG::4326<span class="nt">&lt;/QueryCRS&gt;</span>
  <span class="nt">&lt;QueryMaxFeatures&gt;</span>-1<span class="nt">&lt;/QueryMaxFeatures&gt;</span>
  <span class="nt">&lt;QueryCheckAreaOfUse&gt;</span>false<span class="nt">&lt;/QueryCheckAreaOfUse&gt;</span>

  <span class="nt">&lt;GMLFormat</span> <span class="na">gmlVersion=</span><span class="s">&quot;GML_32&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;MimeType&gt;</span>application/gml+xml; version=3.2<span class="nt">&lt;/MimeType&gt;</span>
    <span class="nt">&lt;MimeType&gt;</span>text/xml; subtype=gml/3.2.1<span class="nt">&lt;/MimeType&gt;</span>
    <span class="nt">&lt;GenerateBoundedByForFeatures&gt;</span>false<span class="nt">&lt;/GenerateBoundedByForFeatures&gt;</span>
    <span class="nt">&lt;GetFeatureResponse</span> <span class="na">xmlns:gml=</span><span class="s">&quot;http://www.opengis.net/gml/3.2&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;ContainerElement&gt;</span>gml:FeatureCollection<span class="nt">&lt;/ContainerElement&gt;</span>
      <span class="nt">&lt;FeatureMemberElement&gt;</span>gml:featureMember<span class="nt">&lt;/FeatureMemberElement&gt;</span>
      <span class="nt">&lt;AdditionalSchemaLocation&gt;</span>http://www.opengis.net/gml/3.2 http://schemas.opengis.net/gml/3.2.1/deprecatedTypes.xsd
      <span class="nt">&lt;/AdditionalSchemaLocation&gt;</span>
      <span class="nt">&lt;DisableStreaming&gt;</span>false<span class="nt">&lt;/DisableStreaming&gt;</span>
      <span class="nt">&lt;PrebindNamespace</span> <span class="na">prefix=</span><span class="s">&quot;ad&quot;</span> <span class="na">uri=</span><span class="s">&quot;urn:x-inspire:specification:gmlas:Addresses:3.0&quot;</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;PrebindNamespace</span> <span class="na">prefix=</span><span class="s">&quot;base&quot;</span> <span class="na">uri=</span><span class="s">&quot;urn:x-inspire:specification:gmlas:BaseTypes:3.2&quot;</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;PrebindNamespace</span> <span class="na">prefix=</span><span class="s">&quot;xlink&quot;</span> <span class="na">uri=</span><span class="s">&quot;http://www.w3.org/1999/xlink&quot;</span><span class="nt">/&gt;</span>      
    <span class="nt">&lt;/GetFeatureResponse&gt;</span>
  <span class="nt">&lt;/GMLFormat&gt;</span>

<span class="nt">&lt;/deegreeWFS&gt;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="configuration-overview">
<h3>5.1.3. Configuration overview<a class="headerlink" href="#configuration-overview" title="Permalink to this headline">¶</a></h3>
<p>The deegree WFS config file format is defined by schema file <a class="reference external" href="http://schemas.deegree.org/services/wfs/3.4.0/wfs_configuration.xsd">http://schemas.deegree.org/services/wfs/3.4.0/wfs_configuration.xsd</a>. The root element is <tt class="docutils literal"><span class="pre">deegreeWFS</span></tt> and the config attribute must be <tt class="docutils literal"><span class="pre">3.4.0</span></tt>. The following table lists all available configuration options (complex ones contain nested options themselves). When specifiying them, their order must be respected.</p>
<table border="1" class="docutils">
<colgroup>
<col width="22%" />
<col width="12%" />
<col width="8%" />
<col width="58%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Option</th>
<th class="head">Cardinality</th>
<th class="head">Value</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>SupportedVersions</td>
<td>0..1</td>
<td>Complex</td>
<td>Activated OGC protocol versions, default: all</td>
</tr>
<tr class="row-odd"><td>FeatureStoreId</td>
<td>0..n</td>
<td>String</td>
<td>Feature stores to attach, default: all</td>
</tr>
<tr class="row-even"><td>EnableTransactions</td>
<td>0..1</td>
<td>Complex</td>
<td>Enable transactions (WFS-T operations), default: false</td>
</tr>
<tr class="row-odd"><td>EnableResponseBuffering</td>
<td>0..1</td>
<td>Boolean</td>
<td>Enable response buffering (expensive), default: false</td>
</tr>
<tr class="row-even"><td>QueryCRS</td>
<td>1..n</td>
<td>String</td>
<td>Announced CRS, first element is the default CRS</td>
</tr>
<tr class="row-odd"><td>QueryMaxFeatures</td>
<td>0..1</td>
<td>Integer</td>
<td>Limit of features returned in a response, default: 15000</td>
</tr>
<tr class="row-even"><td>QueryCheckAreaOfUse</td>
<td>0..1</td>
<td>Boolean</td>
<td>Check spatial query constraints against CRS area, default: false</td>
</tr>
<tr class="row-odd"><td>StoredQuery</td>
<td>0..n</td>
<td>String</td>
<td>File name of StoredQueryDefinition</td>
</tr>
<tr class="row-even"><td>GMLFormat</td>
<td>0..n</td>
<td>Complex</td>
<td>GML format configuration</td>
</tr>
<tr class="row-odd"><td>CustomFormat</td>
<td>0..n</td>
<td>Complex</td>
<td>Custom format configuration</td>
</tr>
</tbody>
</table>
<p>The remainining sections describe these options and their sub-options in detail.</p>
</div>
<div class="section" id="general-options">
<h3>5.1.4. General options<a class="headerlink" href="#general-options" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">SupportedVersions</span></tt>: By default, all implemented WFS protocol versions (1.0.0, 1.1.0 and 2.0.0) will be activated. You can control offered WFS protocol versions using element <tt class="docutils literal"><span class="pre">SupportedVersions</span></tt>. This element allows any combination of the child elements <tt class="docutils literal"><span class="pre">&lt;Version&gt;1.0.0&lt;/Version&gt;</span></tt>, <tt class="docutils literal"><span class="pre">&lt;Version&gt;1.1.0&lt;/Version&gt;</span></tt> and <tt class="docutils literal"><span class="pre">&lt;Version&gt;2.0.0&lt;/Version&gt;</span></tt>.</li>
<li><tt class="docutils literal"><span class="pre">FeatureStoreId</span></tt>: By default, all feature stores in your deegree workspace  will be used for serving feature types. In some cases, this may not be what you want, e.g. because you have two different WFS instances running, or you don&#8217;t want all feature types used in your WMS for rendering to be available via your WFS. Use the <tt class="docutils literal"><span class="pre">FeatureStoreId</span></tt> option to explicitly set the feature stores that this WFS should use.</li>
<li><tt class="docutils literal"><span class="pre">EnableResponseBuffering</span></tt>: By default, WFS responses are directly streamed to the client. This is very much recommended and even a requirement for transferring large responses efficiently. The only drawback happens if exceptions occur, after a partial response has already been transferred. In this case, the client will receive part payload and part exception report. By specifying <tt class="docutils literal"><span class="pre">false</span></tt> here, you can explicitly force buffering of the full response, before it is written to the client. Only if the full response could be generated successfully, it will be transferred. If an exception happens at any time the buffer will be discarded, and an exception report will be sent to the client. Buffering is performed in memory, but switches to a temp file in case the buffer grows bigger than 1 MiB.</li>
<li><tt class="docutils literal"><span class="pre">QueryCRS</span></tt>: Coordinate reference systems for returned geometries. This element can be specified multiple times, and the WFS will announce all CRS in the GetCapabilities response (except for WFS 1.0.0 which does not officially support using multiple coordinate reference systems). The first element always specifies the default CRS (used when no CRS parameter is present in a request).</li>
<li><tt class="docutils literal"><span class="pre">QueryMaxFeatures</span></tt>: By default, a maximum number of 15000 features will be returned for a single <tt class="docutils literal"><span class="pre">GetFeature</span></tt> request. Use this option to override this setting. A value of <tt class="docutils literal"><span class="pre">-1</span></tt> means unlimited.</li>
<li><tt class="docutils literal"><span class="pre">QueryCheckAreaOfUse</span></tt>: By default, spatial query constraints are not checked with regard to the area of validity of the CRS. Set this option to <tt class="docutils literal"><span class="pre">true</span></tt> to enforce this check.</li>
</ul>
</div>
<div class="section" id="transactions">
<h3>5.1.5. Transactions<a class="headerlink" href="#transactions" title="Permalink to this headline">¶</a></h3>
<p>By default, WFS-T requests will be rejected. Setting the <tt class="docutils literal"><span class="pre">EnableTransactions</span></tt> option to <tt class="docutils literal"><span class="pre">true</span></tt> will enable transaction support. This option has the optional attribute <tt class="docutils literal"><span class="pre">idGenMode</span></tt> which controls how ids of inserted features (the values in the gml:id attribute) are treated. There are three id generation modes available:</p>
<ul class="simple">
<li><strong>UseExisting</strong>: The original gml:id values from the input are stored. This may lead to errors if the provided ids are already in use.</li>
<li><strong>GenerateNew</strong> (default): New and unique ids are generated. References in the input GML (xlink:href) that point to a feature with an reassigned id are fixed as well, so reference consistency is maintained.</li>
<li><strong>ReplaceDuplicate</strong>: The WFS will try to use the original gml:id values that have been provided in the input. In case a certain identifier already exists in the backend, a new and unique identifier will be generated. References in the input GML (xlink:href) that point to a feature with an reassigned id are fixed as well, so reference consistency is maintained.</li>
</ul>
<div class="admonition hint">
<p class="first admonition-title">Hint</p>
<p class="last">Currently, transactions can only be enabled if your WFS is attached to a single feature store.</p>
</div>
<div class="admonition hint">
<p class="first admonition-title">Hint</p>
<p class="last">Not every feature store implementation supports transactions, so you may encounter that transactions are rejected, even though you activated them in the WFS configuration.</p>
</div>
<div class="admonition hint">
<p class="first admonition-title">Hint</p>
<p class="last">The details of the id generation depend on the feature store implementation/configuration.</p>
</div>
<div class="admonition hint">
<p class="first admonition-title">Hint</p>
<p class="last">In a WFS 1.1.0 insert, the id generation mode can be overridden by attribute <em>idGenMode</em> of the <tt class="docutils literal"><span class="pre">Insert</span></tt> element. WFS 1.0.0 and WFS 2.0.0 don&#8217;t support to specify the id generation mode on a request basis.</p>
</div>
</div>
<div class="section" id="adapting-gml-output-formats">
<h3>5.1.6. Adapting GML output formats<a class="headerlink" href="#adapting-gml-output-formats" title="Permalink to this headline">¶</a></h3>
<p>By default, a deegree WFS will offer GML 2, 3.0, 3.1, and 3.2 as output formats and announce those formats in the GetCapabilities responses (except for WFS 1.0.0, as this version of the standard has no means of announcing other formats than GML 2). The element for GetFeature responses is <tt class="docutils literal"><span class="pre">wfs:FeatureCollection</span></tt>, as mandated by the WFS specification.</p>
<p>In some cases, you may want to alter aspects of the offered output formats. For example, if you want your WFS to serve a specific application schema (e.g. INSPIRE Data Themes), you should restrict the announced GML versions to the one used for the application schema. These and other output-format related aspects can be controlled by element <tt class="docutils literal"><span class="pre">GMLFormat</span></tt>.</p>
<div class="topic">
<p class="topic-title first">Example for WFS config option <tt class="docutils literal"><span class="pre">GMLFormat</span></tt></p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;GMLFormat</span> <span class="na">gmlVersion=</span><span class="s">&quot;GML_32&quot;</span><span class="nt">&gt;</span>

  <span class="nt">&lt;MimeType&gt;</span>text/xml; subtype=gml/3.2.1<span class="nt">&lt;/MimeType&gt;</span>

  <span class="nt">&lt;GenerateBoundedByForFeatures&gt;</span>false<span class="nt">&lt;/GenerateBoundedByForFeatures&gt;</span>

  <span class="nt">&lt;GetFeatureResponse&gt;</span>
    <span class="nt">&lt;ContainerElement</span> <span class="na">xmlns:gml=</span><span class="s">&quot;http://www.opengis.net/gml/3.2&quot;</span><span class="nt">&gt;</span>gml:FeatureCollection<span class="nt">&lt;/ContainerElement&gt;</span>
    <span class="nt">&lt;FeatureMemberElement</span> <span class="na">xmlns:gml=</span><span class="s">&quot;http://www.opengis.net/gml/3.2&quot;</span><span class="nt">&gt;</span>gml:featureMember<span class="nt">&lt;/FeatureMemberElement&gt;</span>
    <span class="nt">&lt;AdditionalSchemaLocation&gt;</span>
      http://www.opengis.net/gml/3.2 http://schemas.opengis.net/gml/3.2.1/deprecatedTypes.xsd
    <span class="nt">&lt;/AdditionalSchemaLocation&gt;</span>
    <span class="nt">&lt;DisableDynamicSchema&gt;</span>true<span class="nt">&lt;/DisableDynamicSchema&gt;</span>
    <span class="nt">&lt;DisableStreaming&gt;</span>false<span class="nt">&lt;/DisableStreaming&gt;</span>
    <span class="nt">&lt;DecimalCoordinateFormatter</span> <span class="na">places=</span><span class="s">&quot;8&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;GeometryLinearization&gt;</span>
      <span class="nt">&lt;Accuracy&gt;</span>0.1<span class="nt">&lt;/Accuracy&gt;</span>
    <span class="nt">&lt;/GeometryLinearization&gt;</span>    
  <span class="nt">&lt;/GetFeatureResponse&gt;</span>

<span class="nt">&lt;/GMLFormat&gt;</span>
</pre></div>
</div>
</div>
<p>The <tt class="docutils literal"><span class="pre">GMLFormat</span></tt> option has the following sub-options:</p>
<table border="1" class="docutils">
<colgroup>
<col width="23%" />
<col width="11%" />
<col width="7%" />
<col width="60%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Option</th>
<th class="head">Cardinality</th>
<th class="head">Value</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>&#64;gmlVersion</td>
<td>1..1</td>
<td>String</td>
<td>GML version (GML_2, GML_30, GML_31 or GML_32)</td>
</tr>
<tr class="row-odd"><td>MimeType</td>
<td>1..n</td>
<td>String</td>
<td>Mime types associated with this format configuration</td>
</tr>
<tr class="row-even"><td>GenerateBoundedByForFeatures</td>
<td>0..1</td>
<td>Boolean</td>
<td>Forces output of gml:boundedBy property for every feature</td>
</tr>
<tr class="row-odd"><td>GetFeatureResponse</td>
<td>0..1</td>
<td>Complex</td>
<td>Options for controlling GetFeature responses</td>
</tr>
<tr class="row-even"><td>DecimalCoordinateFormatter/
CustomCoordinateFormatter</td>
<td>0..1</td>
<td>Complex</td>
<td>Controls the formatting of geometry coordinates</td>
</tr>
<tr class="row-odd"><td>GeometryLinearization</td>
<td>0..1</td>
<td>Complex</td>
<td>Activates/controls the linearization of exported geometries</td>
</tr>
</tbody>
</table>
<div class="section" id="basic-gml-format-options">
<h4>5.1.6.1. Basic GML format options<a class="headerlink" href="#basic-gml-format-options" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">&#64;gmlVersion</span></tt>: This attribute defines the GML version (GML_2, GML_30, GML_31 or GML_32)</li>
<li><tt class="docutils literal"><span class="pre">MimeType</span></tt>: Mime types associated with this format configuration (and announced in GetCapabilities)</li>
<li><tt class="docutils literal"><span class="pre">GenerateBoundedByForFeatures</span></tt>: By default, the <tt class="docutils literal"><span class="pre">gml:boundedBy</span></tt> property will only be exported for the member features if the feature store provides it. By setting this option to <tt class="docutils literal"><span class="pre">true</span></tt>, the WFS will calculate the envelope and include it as a <tt class="docutils literal"><span class="pre">gml:boundedBy</span></tt> property. Please note that this setting does not affect the inclusion of the <tt class="docutils literal"><span class="pre">gml:boundedBy</span></tt> property for on the feature collection level (see DisableStreaming for that).</li>
</ul>
</div>
<div class="section" id="getfeature-response-settings">
<h4>5.1.6.2. GetFeature response settings<a class="headerlink" href="#getfeature-response-settings" title="Permalink to this headline">¶</a></h4>
<p>Option <tt class="docutils literal"><span class="pre">GetFeatureResponse</span></tt> has the following sub-options:</p>
<table border="1" class="docutils">
<colgroup>
<col width="20%" />
<col width="11%" />
<col width="9%" />
<col width="60%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Option</th>
<th class="head">Cardinality</th>
<th class="head">Value</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>ContainerElement</td>
<td>0..1</td>
<td>QName</td>
<td>Qualified root element name, default: wfs:FeatureCollection</td>
</tr>
<tr class="row-odd"><td>FeatureMemberElement</td>
<td>0..1</td>
<td>QName</td>
<td>Qualified feature member element name, default: gml:featureMember</td>
</tr>
<tr class="row-even"><td>AdditionalSchemaLocation</td>
<td>0..1</td>
<td>String</td>
<td>Added to xsi:schemaLocation attribute of wfs:FeatureCollection</td>
</tr>
<tr class="row-odd"><td>DisableDynamicSchema</td>
<td>0..1</td>
<td>Complex</td>
<td>Controls DescribeFeatureType strategy, default: regenerate schema</td>
</tr>
<tr class="row-even"><td>DisableStreaming</td>
<td>0..1</td>
<td>Boolean</td>
<td>Disables output streaming, include numberOfFeature information/gml:boundedBy</td>
</tr>
<tr class="row-odd"><td>PrebindNamespace</td>
<td>0..n</td>
<td>Complex</td>
<td>Pre-bind namespaces in the root element</td>
</tr>
</tbody>
</table>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">ContainerElement</span></tt>: By default, the container element of a GetFeature response is <tt class="docutils literal"><span class="pre">wfs:FeatureCollection</span></tt>. Using this option, you can specify an alternative element name. In order to bind the namespace prefix, use standard XML namespace mechanisms (xmlns attribute). This option is ignored for WFS 2.0.0.</li>
<li><tt class="docutils literal"><span class="pre">FeatureMemberElement</span></tt>: By default, the member features are included in <tt class="docutils literal"><span class="pre">gml:featureMember</span></tt> (WFS 1.0.0/1.1.0) or <tt class="docutils literal"><span class="pre">wfs:member</span></tt> elements (WFS 2.0.0). Using this option, you can specify an alternative element name. In order to bind the namespace prefix, use standard XML namespace mechanisms (xmlns attribute). This option is ignored for WFS 2.0.0.</li>
<li><tt class="docutils literal"><span class="pre">AdditionalSchemaLocation</span></tt>: By default, the <tt class="docutils literal"><span class="pre">xsi:schemaLocation</span></tt> attribute in a GetFeature response is auto-generated and refers to all schemas necessary for validation of the response. Using this option, you can add additional namespace/URL pairs for adding additional schemas. This may be required when you override the returned container or feature member elements in order to achieve schema-valid output.</li>
<li><tt class="docutils literal"><span class="pre">DisableDynamicSchema</span></tt>: By default, the GML application schema returned in DescribeFeatureType reponses (and referenced in the <tt class="docutils literal"><span class="pre">xsi:schemaLocation</span></tt> of query responses) will be generated dynamically from the internal feature type representation. This allows generation of application schemas for different GML versions and is fine for simple feature models (e.g. feature types served from shapefiles or flat database tables). However, valid re-encoding of complex GML application schema (such as INSPIRE Data Themes) is technically not feasible. In these cases, you will have to set this option to <tt class="docutils literal"><span class="pre">false</span></tt>, so the WFS will produce a response that refers to the original schema files used for configuring the feature store. If you want the references to point to an external copy of your GML application schema files (instead of pointing back to the deegree WFS), use the optional attribute <tt class="docutils literal"><span class="pre">baseURL</span></tt> that this element provides.</li>
<li><tt class="docutils literal"><span class="pre">DisableStreaming</span></tt>: By default, returned features are not collected in memory, but directly streamed from the backend (e.g. an SQL database) and individually encoded as GML. This enables the querying of huge numbers of features with only minimal memory footprint. However, by using this strategy, the number of features and their bounding box is not known when the WFS starts to write out the response. Therefore, this information is omitted from the response (which is perfectly valid according to WFS 1.0.0 and 1.1.0, and a change request for WFS 2.0.0 has been accepted). If you find that your WFS client has problems with the response, you may set this option to <tt class="docutils literal"><span class="pre">false</span></tt>. Features will be collected in memory first and the generated response will include numberOfFeature information and gml:boundedBy for the collection. However, for huge response and heavy server load, this is not recommended as it introduces significant overhead and may result in out-of-memory errors.</li>
<li><tt class="docutils literal"><span class="pre">PrebindNamespace</span></tt>: By default, XML namespaces are bound when they are needed. This will result in valid output, but may lead to the same namespace being bound again and again in different parts of the response document. Using this option, namespaces can be bound in the root element, so they are defined for the full scope of the response document and do not need re-definition at several positions in the document. This option has the required attributes <tt class="docutils literal"><span class="pre">prefix</span></tt> and <tt class="docutils literal"><span class="pre">uri</span></tt>.</li>
</ul>
</div>
<div class="section" id="coordinate-formatters">
<h4>5.1.6.3. Coordinate formatters<a class="headerlink" href="#coordinate-formatters" title="Permalink to this headline">¶</a></h4>
<p>By default, GML geometries will be encoded using 6 decimal places for CRS with degree axes and 3 places for CRS with metric axes. In order to override this, two options are available:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">DecimalCoordinatesFormatter</span></tt>: Empty element, attribute <tt class="docutils literal"><span class="pre">places</span></tt> specifies the number of decimal places.</li>
<li><tt class="docutils literal"><span class="pre">CustomCoordinateFormatter</span></tt>: By specifiying this element, an implementation of Java interface <tt class="docutils literal"><span class="pre">org.deegree.geometry.io.CoordinateFormatter</span></tt> can be instantiated. Child element <tt class="docutils literal"><span class="pre">JavaClass</span></tt> contains the qualified name of the Java class (which must be on the classpath).</li>
</ul>
</div>
<div class="section" id="geometry-linearization">
<h4>5.1.6.4. Geometry linearization<a class="headerlink" href="#geometry-linearization" title="Permalink to this headline">¶</a></h4>
<p>Some feature stores (e.g. the SQL feature store when connected to an Oracle Spatial database) can deliver non-linear geometries (e.g. arcs). Here&#8217;s an example for the GML 3.1.1 encoding of such a geometry as it would be returned by the WFS:</p>
<div class="topic">
<p class="topic-title first">Example for a non-linear GML geometry</p>
<div class="highlight-xml"><div class="highlight"><pre>...
<span class="nt">&lt;gml:Polygon</span> <span class="na">srsName=</span><span class="s">&quot;urn:ogc:def:crs:EPSG::28992&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;gml:exterior&gt;</span>
    <span class="nt">&lt;gml:Ring</span> <span class="na">srsName=</span><span class="s">&quot;urn:ogc:def:crs:EPSG::28992&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;gml:curveMember&gt;</span>
        <span class="nt">&lt;gml:Curve</span> <span class="na">srsName=</span><span class="s">&quot;urn:ogc:def:crs:EPSG::28992&quot;</span><span class="nt">&gt;</span>
          <span class="nt">&lt;gml:segments&gt;</span>
            <span class="nt">&lt;gml:Arc&gt;</span>
              <span class="nt">&lt;gml:posList&gt;</span>240190.182 488008.760 240160.182 487978.760 240190.182 487948.760<span class="nt">&lt;/gml:posList&gt;</span>
            <span class="nt">&lt;/gml:Arc&gt;</span>
            <span class="nt">&lt;gml:Arc&gt;</span>
              <span class="nt">&lt;gml:posList&gt;</span>240190.182 487948.760 240220.182 487978.760 240190.182 488008.760<span class="nt">&lt;/gml:posList&gt;</span>
            <span class="nt">&lt;/gml:Arc&gt;</span>
          <span class="nt">&lt;/gml:segments&gt;</span>
        <span class="nt">&lt;/gml:Curve&gt;</span>
      <span class="nt">&lt;/gml:curveMember&gt;</span>
    <span class="nt">&lt;/gml:Ring&gt;</span>
  <span class="nt">&lt;/gml:exterior&gt;</span>
<span class="nt">&lt;/gml:Polygon&gt;</span>
...
</pre></div>
</div>
</div>
<p>This is perfectly valid GML, but there are two reasons why you may not want your WFS to return non-linear GML geometries:</p>
<ul class="simple">
<li>There&#8217;s no encoding for non-linear GML geometries in GML version 2</li>
<li>Currently available WFS clients (e.g. QGIS, uDig, ...) cannot cope with them</li>
</ul>
<p>Option <tt class="docutils literal"><span class="pre">GeometryLinearization</span></tt> will ensure that GML responses will only contain linear geometries. Curves with non-linear segments and surfaces with non-linear boundary segments will be converted before they are encoded to GML. Here&#8217;s an example usage of this GML format option:</p>
<div class="topic">
<p class="topic-title first">Example config snippet for activating geometry linearization</p>
<div class="highlight-xml"><div class="highlight"><pre>...
<span class="nt">&lt;GeometryLinearization&gt;</span>
  <span class="nt">&lt;Accuracy&gt;</span>0.1<span class="nt">&lt;/Accuracy&gt;</span>
<span class="nt">&lt;/GeometryLinearization&gt;</span>
...
</pre></div>
</div>
</div>
<p><tt class="docutils literal"><span class="pre">GeometryLinearization</span></tt> has a single mandatory option <tt class="docutils literal"><span class="pre">Accuracy</span></tt>. It defines the numerical accuracy of the linear approximation in units of the coordinate reference system used by the feature store. If the coordinate reference system is based on meters, a value of 0.1 will ensure that the maximum error between the original and the linearized geometry does not exceed 10 centimeters.</p>
<p>Here&#8217;s an example of a linearized version of the example geometry as it would be generated by the WFS:</p>
<div class="topic">
<p class="topic-title first">Example for linearized GML output</p>
<div class="highlight-xml"><div class="highlight"><pre>...
<span class="nt">&lt;gml:Polygon</span> <span class="na">srsName=</span><span class="s">&quot;urn:ogc:def:crs:EPSG::28992&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;gml:exterior&gt;</span>
    <span class="nt">&lt;gml:Ring</span> <span class="na">srsName=</span><span class="s">&quot;urn:ogc:def:crs:EPSG::28992&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;gml:curveMember&gt;</span>
        <span class="nt">&lt;gml:Curve</span> <span class="na">srsName=</span><span class="s">&quot;urn:ogc:def:crs:EPSG::28992&quot;</span><span class="nt">&gt;</span>
          <span class="nt">&lt;gml:segments&gt;</span>
            <span class="nt">&lt;gml:LineStringSegment</span> <span class="na">interpolation=</span><span class="s">&quot;linear&quot;</span><span class="nt">&gt;</span>
              <span class="nt">&lt;gml:posList&gt;</span>240190.182 488008.760 240177.165 488005.789 240166.727 487997.465 240160.934 487985.436 240160.934 487972.084 240166.727 487960.055 240177.165 487951.731 240190.182 487948.760<span class="nt">&lt;/gml:posList&gt;</span>
            <span class="nt">&lt;/gml:LineStringSegment&gt;</span>
            <span class="nt">&lt;gml:LineStringSegment</span> <span class="na">interpolation=</span><span class="s">&quot;linear&quot;</span><span class="nt">&gt;</span>
              <span class="nt">&lt;gml:posList&gt;</span>240190.182 487948.760 240203.199 487951.731 240213.637 487960.055 240219.430 487972.084 240219.430 487985.436 240213.637 487997.465 240203.199 488005.789 240190.182 488008.760<span class="nt">&lt;/gml:posList&gt;</span>
            <span class="nt">&lt;/gml:LineStringSegment&gt;</span>
          <span class="nt">&lt;/gml:segments&gt;</span>
        <span class="nt">&lt;/gml:Curve&gt;</span>
      <span class="nt">&lt;/gml:curveMember&gt;</span>
    <span class="nt">&lt;/gml:Ring&gt;</span>
  <span class="nt">&lt;/gml:exterior&gt;</span>
<span class="nt">&lt;/gml:Polygon&gt;</span>
...
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="adding-custom-output-formats">
<h3>5.1.7. Adding custom output formats<a class="headerlink" href="#adding-custom-output-formats" title="Permalink to this headline">¶</a></h3>
<p>Using option element <tt class="docutils literal"><span class="pre">CustomFormat</span></tt>, it possible to plug-in your own Java classes to generate the output for a specific mime type (e.g. a binary format)</p>
<table border="1" class="docutils">
<colgroup>
<col width="13%" />
<col width="15%" />
<col width="10%" />
<col width="62%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Option</th>
<th class="head">Cardinality</th>
<th class="head">Value</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>MimeType</td>
<td>1..n</td>
<td>String</td>
<td>Mime types associated with this format configuration</td>
</tr>
<tr class="row-odd"><td>JavaClass</td>
<td>1..1</td>
<td>String</td>
<td>Qualified Java class name</td>
</tr>
<tr class="row-even"><td>Config</td>
<td>0..1</td>
<td>Complex</td>
<td>Value to add to xsi:schemaLocation attribute</td>
</tr>
</tbody>
</table>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">MimeType</span></tt>: Mime types associated with this format configuration (and announced in GetCapabilities)</li>
<li><tt class="docutils literal"><span class="pre">JavaClass</span></tt>: Therefore, an implementation of interface <tt class="docutils literal"><span class="pre">org.deegree.services.wfs.format.CustomFormat</span></tt> must be present on the classpath.</li>
<li><tt class="docutils literal"><span class="pre">Config</span></tt>:</li>
</ul>
</div>
<div class="section" id="stored-queries">
<h3>5.1.8. Stored queries<a class="headerlink" href="#stored-queries" title="Permalink to this headline">¶</a></h3>
<p>Besides standard (&#8216;ad hoc&#8217;) queries, WFS 2.0.0 introduces so-called stored queries. When WFS 2.0.0 support is activated, your WFS will automatically support the well-known stored query <tt class="docutils literal"><span class="pre">urn:ogc:def:storedQuery:OGC-WFS::GetFeatureById</span></tt> (defined in the WFS 2.0.0 specification). It can be used to query a feature instance by specifying it&#8217;s gml:id (similar to GetGmlObject requests in WFS 1.1.0). In order to define custom stored queries, use the <tt class="docutils literal"><span class="pre">StoredQuery</span></tt> element to specify the file name of a StoredQueryDefinition file. The given file name (can be relative) must point to a valid WFS 2.0.0 StoredQueryDefinition file. Here&#8217;s an example:</p>
<div class="topic">
<p class="topic-title first">Example for a WFS 2.0.0 StoredQueryDefinition file</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;StoredQueryDefinition</span> <span class="na">id=</span><span class="s">&quot;urn:x-inspire:query:GetAddressesForStreet&quot;</span>
  <span class="na">xmlns=</span><span class="s">&quot;http://www.opengis.net/wfs/2.0&quot;</span>
  <span class="na">xmlns:ad=</span><span class="s">&quot;urn:x-inspire:specification:gmlas:Addresses:3.0&quot;</span>
  <span class="na">xmlns:gn=</span><span class="s">&quot;urn:x-inspire:specification:gmlas:GeographicalNames:3.0&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;Title&gt;</span>GetAddressesForStreet<span class="nt">&lt;/Title&gt;</span>
  <span class="nt">&lt;Abstract&gt;</span>Returns the ad:Address features located in the specified street.<span class="nt">&lt;/Abstract&gt;</span>
  <span class="nt">&lt;Parameter</span> <span class="na">name=</span><span class="s">&quot;streetName&quot;</span> <span class="na">type=</span><span class="s">&quot;xs:string&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;Abstract&gt;</span>Name of the street (mandatory)<span class="nt">&lt;/Abstract&gt;</span>
  <span class="nt">&lt;/Parameter&gt;</span>
  <span class="nt">&lt;QueryExpressionText</span> <span class="na">returnFeatureTypes=</span><span class="s">&quot;ad:Address&quot;</span>
   <span class="na">language=</span><span class="s">&quot;urn:ogc:def:queryLanguage:OGC-:WFSQueryExpression&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;Query</span> <span class="na">typeNames=</span><span class="s">&quot;ad:Address&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;Filter</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.opengis.net/fes/2.0&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;PropertyIsEqualTo&gt;</span>
          <span class="nt">&lt;ValueReference&gt;</span>
ad:component/ad:ThoroughfareName/ad:name/gn:GeographicalName/gn:spelling/gn:SpellingOfName/gn:text
          <span class="nt">&lt;/ValueReference&gt;</span>
          <span class="nt">&lt;Literal&gt;</span>${streetName}<span class="nt">&lt;/Literal&gt;</span>
        <span class="nt">&lt;/PropertyIsEqualTo&gt;</span>
      <span class="nt">&lt;/Filter&gt;</span>
    <span class="nt">&lt;/Query&gt;</span>
  <span class="nt">&lt;/QueryExpressionText&gt;</span>
<span class="nt">&lt;/StoredQueryDefinition&gt;</span>
</pre></div>
</div>
</div>
<p>This example is actually usable if your WFS is set up to serve the ad:Address feature type from INSPIRE Annex I. It defines the stored query <tt class="docutils literal"><span class="pre">urn:x-inspire:storedQuery:GetAddressesForStreet</span></tt> for retrieving ad:Address features that are located in the specified street. The street name is passed using parameter <tt class="docutils literal"><span class="pre">streetName</span></tt>. If your WFS instance can be reached at <tt class="docutils literal"><span class="pre">http://localhost:8080/services</span></tt>, you could use the request <tt class="docutils literal"><span class="pre">http://localhost:8080/services?request=GetFeature&amp;storedquery_id=urn:x-inspire:storedQuery:GetAddressesForStreet&amp;streetName=Madame%20Curiestraat</span></tt> to fetch the ad:Address features in street Madame Curiestraat.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">deegree WFS supports the execution of stored queries using <tt class="docutils literal"><span class="pre">GetFeature</span></tt> and <tt class="docutils literal"><span class="pre">GetPropertyValue</span></tt> requests. It also implements the <tt class="docutils literal"><span class="pre">ListStoredQueries</span></tt> and the <tt class="docutils literal"><span class="pre">DescribeStoredQueries</span></tt> operations. However, there is no support for <tt class="docutils literal"><span class="pre">CreateStoredQuery</span></tt> and <tt class="docutils literal"><span class="pre">DropStoredQuery</span></tt> at the moment.</p>
</div>
</div>
</div>
<div class="section" id="web-map-service-wms">
<span id="anchor-configuration-wms"></span><h2>5.2. Web Map Service (WMS)<a class="headerlink" href="#web-map-service-wms" title="Permalink to this headline">¶</a></h2>
<p>In deegree terminology, a deegree WMS renders maps from data stored in feature, coverage and tile stores. The WMS is configured using a layer structure, called a <em>theme</em>. A theme can be thought of as a collection of layers, organized in a tree structure. <em>What</em> the layers show is configured in a layer configuration, and <em>how</em> it is shown is configured in a style file. Supported style languages are StyledLayerDescriptor (SLD) and Symbology Encoding (SE).</p>
<div class="figure" style="width: 80%">
<a class="reference external image-reference" href="_images/workspace-wms.png"><img alt="_images/workspace-wms.png" src="_images/workspace-wms.png" style="width: 80%;" /></a>
<p class="caption">A WMS resource is connected to exactly one theme resource</p>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">In order to fully understand deegree WMS configuration, you will have to learn configuration of other workspace aspects as well. Chapter <a class="reference internal" href="renderstyles.html#anchor-configuration-renderstyles"><em>Map styles</em></a> describes the creation of layers and styling rules. Chapter <a class="reference internal" href="featurestores.html#anchor-configuration-featurestore"><em>Feature stores</em></a> describes the configuration of vector data access and chapter <a class="reference internal" href="coveragestores.html#anchor-configuration-coveragestore"><em>Coverage stores</em></a> describes the configuration of raster data access.</p>
</div>
<div class="section" id="a-word-on-layers-and-themes">
<h3>5.2.1. A word on layers and themes<a class="headerlink" href="#a-word-on-layers-and-themes" title="Permalink to this headline">¶</a></h3>
<p>Readers familiar with the WMS protocol might be wondering why layers can not be configured directly in the WMS configuration file. Inspired by WMTS 1.0.0 we found the idea to separate structure and content very appealing. Thinking of a layer store that just offers a set of layers is an easy concept. Thinking of a theme as a structure that may contain layers at certain points also makes sense. But when thinking of WMS the terms begin clashing. We suggest to avoid confusion as much as possible by using the same name for each corresponding theme, layer and possibly even tile/feature/coverage data sources. We believe that once you work a little with the concept of themes, and seeing them exported as WMS layer trees, the concepts fit well enough so you can appreciate the clean cut.</p>
</div>
<div class="section" id="id1">
<h3>5.2.2. Configuration overview<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>The configuration can be split up in six sections. Readers familiar with other deegree service configurations may recognize some similarities, but we&#8217;ll describe the options anyway, because there may be subtle differences. A document template looks like this:</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="cp">&lt;?xml version=&#39;1.0&#39;?&gt;</span>
<span class="nt">&lt;deegreeWMS</span> <span class="na">xmlns=</span><span class="s">&#39;http://www.deegree.org/services/wms&#39;</span><span class="nt">&gt;</span>
  <span class="c">&lt;!-- actual configuration goes here --&gt;</span>
<span class="nt">&lt;/deegreeWMS&gt;</span>
</pre></div>
</div>
<p>The following table shows what top level options are available.</p>
<table border="1" class="docutils">
<colgroup>
<col width="20%" />
<col width="11%" />
<col width="7%" />
<col width="61%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Option</th>
<th class="head">Cardinality</th>
<th class="head">Value</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>SupportedVersions</td>
<td>0..1</td>
<td>Complex</td>
<td>Limits active OGC protocol versions</td>
</tr>
<tr class="row-odd"><td>MetadataStoreId</td>
<td>0..1</td>
<td>String</td>
<td>Configures a metadata store to check if metadata ids for layers exist</td>
</tr>
<tr class="row-even"><td>MetadataURLTemplate</td>
<td>0..1</td>
<td>String</td>
<td>Template for generating URLs to feature type metadata</td>
</tr>
<tr class="row-odd"><td>ServiceConfiguration</td>
<td>1</td>
<td>Complex</td>
<td>Configures service content</td>
</tr>
<tr class="row-even"><td>FeatureInfoFormats</td>
<td>0..1</td>
<td>Complex</td>
<td>Configures additional feature info output formats</td>
</tr>
<tr class="row-odd"><td>ExtendedCapabilities</td>
<td>0..n</td>
<td>Complex</td>
<td>Extended Metadata reported in GetCapabilities response</td>
</tr>
<tr class="row-even"><td>LayerLimit</td>
<td>0..1</td>
<td>Integer</td>
<td>Maximum number of layers in a GetMap request, default: unlimited</td>
</tr>
<tr class="row-odd"><td>MaxWidth</td>
<td>0..1</td>
<td>Integer</td>
<td>Maximum width in a GetMap request, default: unlimited</td>
</tr>
<tr class="row-even"><td>MaxHeight</td>
<td>0..1</td>
<td>Integer</td>
<td>Maximum height in a GetMap request, default: unlimited</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="basic-options">
<h3>5.2.3. Basic options<a class="headerlink" href="#basic-options" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">SupportedVersions</span></tt>: By default, all implemented WMS protocol versions (1.1.1 and 1.3.0) are activated. You can control offered WMS protocol versions using the element <tt class="docutils literal"><span class="pre">SupportedVersions</span></tt>. This element allows any of the child elements <tt class="docutils literal"><span class="pre">&lt;Version&gt;1.1.1&lt;/Version&gt;</span></tt> and <tt class="docutils literal"><span class="pre">&lt;Version&gt;1.3.0&lt;/Version&gt;</span></tt>.</li>
<li><tt class="docutils literal"><span class="pre">MetadataStoreId</span></tt>: If set to a valid metadata store, the store is queried upon startup with all configured layer metadata set ids. If a metadata set does not exist in the metadata store, it will not be exported as metadata URL in the capabilties. This is a useful option if you want to automatically check for configuration errors/typos. By default, no checking is done.</li>
<li><tt class="docutils literal"><span class="pre">MetadataURLTemplate</span></tt>: By default, no metadata URLs are generated for layers in the capabilities. You can set this option either to a unique URL, which will be exported as is, or to a template with a placeholder. In any case, a metadata URL will only be exported if the layer has a metadata set id set. A template looks like this: <a class="reference external" href="http://discovery.eu/csw?service=CSW&amp;amp;request=GetRecordById&amp;amp;version=2.0.2&amp;amp">http://discovery.eu/csw?service=CSW&amp;amp;request=GetRecordById&amp;amp;version=2.0.2&amp;amp</a>;id=${metadataSetId}&amp;amp;outputSchema=http://www.isotc211.org/2005/gmd&amp;amp;elementSetName=full. Please note that you&#8217;ll need to escape the &amp; symbols with &amp;amp; as shown in the example. The ${metadataSetId} will be replaced with the metadata set id from each layer.</li>
</ul>
<p>Here is a snippet for quick copy &amp; paste:</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;SupportedVersions&gt;</span>
  <span class="nt">&lt;SupportedVersion&gt;</span>1.1.1<span class="nt">&lt;/SupportedVersion&gt;</span>
<span class="nt">&lt;/SupportedVersions&gt;</span>
<span class="nt">&lt;MetadataStoreId&gt;</span>mdstore<span class="nt">&lt;/MetadataStoreId&gt;</span>
<span class="nt">&lt;MetadataURLTemplate&gt;</span>http://discovery.eu/csw?service=CSW<span class="ni">&amp;amp;</span>request=GetRecordById<span class="ni">&amp;amp;</span>version=2.0.2<span class="ni">&amp;amp;</span>id=${metadataSetId}<span class="ni">&amp;amp;</span>outputSchema=http://www.isotc211.org/2005/gmd<span class="ni">&amp;amp;</span>elementSetName=full<span class="nt">&lt;/MetadataURLTemplate&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="service-content-configuration">
<h3>5.2.4. Service content configuration<a class="headerlink" href="#service-content-configuration" title="Permalink to this headline">¶</a></h3>
<p>You can configure the behaviour of layers using the <tt class="docutils literal"><span class="pre">DefaultLayerOptions</span></tt> element.</p>
<p>Have a look at the layer options and their values:</p>
<table border="1" class="docutils">
<colgroup>
<col width="16%" />
<col width="12%" />
<col width="7%" />
<col width="65%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Option</th>
<th class="head">Cardinality</th>
<th class="head">String</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Antialiasing</td>
<td>0..1</td>
<td>String</td>
<td>Whether to antialias NONE, TEXT, IMAGE or BOTH, default is BOTH</td>
</tr>
<tr class="row-odd"><td>RenderingQuality</td>
<td>0..1</td>
<td>String</td>
<td>Whether to render LOW, NORMAL or HIGH quality, default is HIGH</td>
</tr>
<tr class="row-even"><td>Interpolation</td>
<td>0..1</td>
<td>String</td>
<td>Whether to use BILINEAR, NEAREST_NEIGHBOUR or BICUBIC interpolation, default is NEAREST_NEIGHBOUR</td>
</tr>
<tr class="row-odd"><td>MaxFeatures</td>
<td>0..1</td>
<td>Integer</td>
<td>Maximum number of features to render at once, default is 10000</td>
</tr>
<tr class="row-even"><td>FeatureInfoRadius</td>
<td>0..1</td>
<td>Integer</td>
<td>Number of pixels to consider when doing GetFeatureInfo, default is 1</td>
</tr>
</tbody>
</table>
<p>You can configure the WMS to use one or more preconfigured themes. In WMS terms, each theme is mapped to a layer in the WMS capabilities. So if you use one theme, the WMS root layer corresponds to the root theme. If you use multiple themes, a synthetic root layer is exported in the capabilities, with one child layer corresponding to each root theme. The themes are configured using the <tt class="docutils literal"><span class="pre">ThemeId</span></tt> element.</p>
<p>Here is an example snippet of the content section:</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;ServiceConfiguration&gt;</span>

  <span class="nt">&lt;DefaultLayerOptions&gt;</span>
    <span class="nt">&lt;Antialiasing&gt;</span>NONE<span class="nt">&lt;/Antialiasing&gt;</span>
  <span class="nt">&lt;/DefaultLayerOptions&gt;</span>

  <span class="nt">&lt;ThemeId&gt;</span>mytheme<span class="nt">&lt;/ThemeId&gt;</span>

<span class="nt">&lt;/ServiceConfiguration&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="custom-feature-info-formats">
<span id="anchor-featureinfo-configuration"></span><h3>5.2.5. Custom feature info formats<a class="headerlink" href="#custom-feature-info-formats" title="Permalink to this headline">¶</a></h3>
<p>Any mime type can be configured to be available as response format for GetFeatureInfo requests, although the most commonly used is probably <tt class="docutils literal"><span class="pre">text/html</span></tt>. There are two alternative ways of controlling how the output is generated (besides using the default HTML output). One involves a deegree specific templating mechanism, the other involves writing an XSLT script. The deegree specific mechanism has the advantage of being considerably less verbose, making common use cases very easy, while the XSLT approach gives you all the freedom.</p>
<p>This is how the configuration section looks like for configuring a deegree templating based format:</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;FeatureInfoFormats&gt;</span>
  <span class="nt">&lt;GetFeatureInfoFormat&gt;</span>
    <span class="nt">&lt;File&gt;</span>../customformat.gfi<span class="nt">&lt;/File&gt;</span>
    <span class="nt">&lt;Format&gt;</span>text/html<span class="nt">&lt;/Format&gt;</span>
  <span class="nt">&lt;/GetFeatureInfoFormat&gt;</span>
<span class="nt">&lt;/FeatureInfoFormats&gt;</span>
</pre></div>
</div>
<p>The configuration for the XSLT approach looks like this:</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;FeatureInfoFormats&gt;</span>
  <span class="nt">&lt;GetFeatureInfoFormat&gt;</span>
    <span class="nt">&lt;XSLTFile</span> <span class="na">gmlVersion=</span><span class="s">&quot;GML_32&quot;</span><span class="nt">&gt;</span>../customformat.xsl<span class="nt">&lt;/XSLTFile&gt;</span>
    <span class="nt">&lt;Format&gt;</span>text/html<span class="nt">&lt;/Format&gt;</span>
  <span class="nt">&lt;/GetFeatureInfoFormat&gt;</span>
<span class="nt">&lt;/FeatureInfoFormats&gt;</span>
</pre></div>
</div>
<p>Of course it is possible to define as many custom formats as you want, as long as you use a different mime type for each (just duplicate the <tt class="docutils literal"><span class="pre">GetFeatureInfoFormat</span></tt> element). If you use one of the default formats, the default output will be overridden with your configuration.</p>
<p>In order to write your XSLT script, you&#8217;ll need to develop it against a specific GML version (namespaces between GML versions may differ, GML output itself will differ). The default is GML 3.2, you can override it by specifying the <tt class="docutils literal"><span class="pre">gmlVersion</span></tt> attribute on the <tt class="docutils literal"><span class="pre">XSLTFile</span></tt> element. Valid GML version strings are <tt class="docutils literal"><span class="pre">GML_2</span></tt>, <tt class="docutils literal"><span class="pre">GML_30</span></tt>, <tt class="docutils literal"><span class="pre">GML_31</span></tt> and <tt class="docutils literal"><span class="pre">GML_32</span></tt>.</p>
<p>If you want to learn more about the templating format, read the following sections.</p>
</div>
<div class="section" id="featureinfo-templating-format">
<h3>5.2.6. FeatureInfo templating format<a class="headerlink" href="#featureinfo-templating-format" title="Permalink to this headline">¶</a></h3>
<p>The templating format can be used to create text based output formats for featureinfo output. It uses a number of definitions, rules and special constructs to replace content with other content based on feature and property values. Please note that you should make sure your file is UTF-8 encoded if you&#8217;re using umlauts.</p>
<div class="section" id="introduction-example">
<h4>5.2.6.1. Introduction/Example<a class="headerlink" href="#introduction-example" title="Permalink to this headline">¶</a></h4>
<p>This section gives a quick overview how the format works and demonstrates the development of a small sample HTML output.</p>
<p>On top level, you can have a number of <em>template definitions</em>. A template always has a name, and there always needs to be a template named <tt class="docutils literal"><span class="pre">start</span></tt> (yes, it&#8217;s the one we start with).</p>
<p>A simple valid templating file that does not actually depend on the features coming in looks like this:</p>
<div class="highlight-xml"><div class="highlight"><pre>&lt;?template start&gt;
&lt;html&gt;
&lt;body&gt;
  &lt;p&gt;Hello&lt;/p&gt;
&lt;/body&gt;
&lt;/html&gt;
</pre></div>
</div>
<p>A featureinfo request will now always yield the body of this template. In order to use the features coming in, you need to define other templates, and call them from a template. So let&#8217;s add another template, and call it from the <tt class="docutils literal"><span class="pre">start</span></tt> template:</p>
<div class="highlight-xml"><div class="highlight"><pre>&lt;?template start&gt;
&lt;html&gt;
&lt;body&gt;
&lt;ul&gt;
&lt;?feature *:myfeaturetemplate&gt;
&lt;/ul&gt;
&lt;/body&gt;
&lt;/html&gt;

&lt;?template myfeaturetemplate&gt;
&lt;li&gt;I have a feature&lt;/li&gt;
</pre></div>
</div>
<p>What happens now is that first the body of the <tt class="docutils literal"><span class="pre">start</span></tt> template is being output. In that output, the <tt class="docutils literal"><span class="pre">&lt;?feature</span> <span class="pre">*:myfeaturetemplate&gt;</span></tt> is replaced with the content of the <tt class="docutils literal"><span class="pre">myfeaturetemplate</span></tt> template for each feature in the feature collection. So if your query hits five features, you&#8217;ll get five <tt class="docutils literal"><span class="pre">li</span></tt> tags like in the template. The asterisk is used to select all features, it&#8217;s possible to limit the number of objects matched. See below in the reference section for a detailed explanation on how it works.</p>
<p>Within the <tt class="docutils literal"><span class="pre">myfeaturetemplate</span></tt> template you have switched context. In the <tt class="docutils literal"><span class="pre">start</span></tt> template your context is the feature collection, and you can call <em>feature templates</em>. In the <tt class="docutils literal"><span class="pre">myfeaturetemplate</span></tt> you &#8216;went down&#8217; the tree and are now in a feature context, where you can call <em>property templates</em>. So what can we do in a feature context? Let&#8217;s start simple by writing out the feature type name. Change the <tt class="docutils literal"><span class="pre">myfeaturetemplate</span></tt> like this:</p>
<div class="highlight-xml"><div class="highlight"><pre>&lt;?template myfeaturetemplate&gt;
&lt;li&gt;I have a &lt;?name&gt; feature&lt;/li&gt;
</pre></div>
</div>
<p>What happens now is that for each use of the <tt class="docutils literal"><span class="pre">myfeaturetemplate</span></tt> the <tt class="docutils literal"><span class="pre">&lt;?name&gt;</span></tt> part is being replaced with the name of the feature type of the feature you hit. So if you hit two features, each of a different type, you get two different <tt class="docutils literal"><span class="pre">li</span></tt> tags in the document, each with its name written in it.</p>
<p>So deegree only replaces the <em>template call</em> in the <tt class="docutils literal"><span class="pre">start</span></tt> template with its replacement once the special constructs in the <em>called</em> template are all replaced, and all the special constructs/calls within <em>that</em> template are all replaced, ... and so on.</p>
<p>Let&#8217;s take it to the next level. What&#8217;s you really want to do in featureinfo responses is of course get the value of the features&#8217; properties. So let&#8217;s add another template, and call it from the <tt class="docutils literal"><span class="pre">myfeaturetemplate</span></tt> template:</p>
<div class="highlight-xml"><div class="highlight"><pre>&lt;?template myfeaturetemplate&gt;
&lt;li&gt;I have a &lt;?name&gt; feature and properties: &lt;?property *:mypropertytemplate&gt;&lt;/li&gt;

&lt;?template mypropertytemplate&gt;
&lt;?name&gt;=&lt;?value&gt;
</pre></div>
</div>
<p>Now you also get all property names and values in the <tt class="docutils literal"><span class="pre">li</span></tt> item. Note that again you switched the context in the template, now you are at property level. The <tt class="docutils literal"><span class="pre">&lt;?name&gt;</span></tt> and <tt class="docutils literal"><span class="pre">&lt;?value&gt;</span></tt> special constructs yield the property name and value, respectively (remember, we&#8217;re at property level here).</p>
<p>While that&#8217;s already nice, people often put non human readable values in properties, even property names are sometimes not human readable. In order to fix that, you often have code lists mapping the codes to proper text. To use these, there&#8217;s a special kind of template called a <em>map</em>. A map is like a simple property file. Let&#8217;s have a look at how to define one:</p>
<div class="highlight-xml"><div class="highlight"><pre>&lt;?map mycodelistmap&gt;
code1=Street
code2=Highway
code3=Railway

&lt;?map mynamecodelistmap&gt;
tp=Type of way
</pre></div>
</div>
<p>Looks simple enough. Instead of <tt class="docutils literal"><span class="pre">template</span></tt> we use map, after that comes the name. Then we just map codes to values. So how do we use this? Instead of just using the <tt class="docutils literal"><span class="pre">&lt;?name&gt;</span></tt> or <tt class="docutils literal"><span class="pre">&lt;?value&gt;</span></tt> we push it through the map:</p>
<div class="highlight-xml"><div class="highlight"><pre>&lt;?template mypropertytemplate&gt;
&lt;?name:map mynamecodelistmap&gt;=&lt;?value:map mycodelistmap&gt;
</pre></div>
</div>
<p>Here the name of the property is replaced with values from the <tt class="docutils literal"><span class="pre">mynamecodelistmap</span></tt>, the value is replaced with values from the <tt class="docutils literal"><span class="pre">mycodelistmap</span></tt>. If the map does not contain a fitting mapping, the original value is used instead.</p>
<p>That concludes the introduction, the next section explains all available special constructs in detail.</p>
</div>
<div class="section" id="templating-special-constructs">
<h4>5.2.6.2. Templating special constructs<a class="headerlink" href="#templating-special-constructs" title="Permalink to this headline">¶</a></h4>
<p>This section shows all available special constructs. The selectors are explained in the table below. The validity describes in which context the construct can be used (and where the description applies). The validity can be one of <em>top level</em> (which means it&#8217;s the definition of something), <em>featurecollection</em> (the <tt class="docutils literal"><span class="pre">start</span></tt> template), <em>feature</em> (a template on feature level), <em>property</em> (a template on property level) or <em>map</em> (a map definition).</p>
<table border="1" class="docutils">
<colgroup>
<col width="21%" />
<col width="13%" />
<col width="66%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Construct</th>
<th class="head">Validity</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>&lt;?template <em>name</em>&gt;</td>
<td>top level</td>
<td>defines a template with name <em>name</em></td>
</tr>
<tr class="row-odd"><td>&lt;?map <em>name</em>&gt;</td>
<td>top level</td>
<td>defines a map with name <em>name</em></td>
</tr>
<tr class="row-even"><td>&lt;?feature <em>selector</em>:<em>name</em>&gt;</td>
<td>featurecollection</td>
<td>calls the template with name <em>name</em> for features matching the selector <em>selector</em></td>
</tr>
<tr class="row-odd"><td>&lt;?property <em>selector</em>:<em>name</em>&gt;</td>
<td>feature</td>
<td>calls the template with name <em>name</em> for properties matching the selector <em>selector</em></td>
</tr>
<tr class="row-even"><td>&lt;?name&gt;</td>
<td>feature</td>
<td>evaluates to the feature type name</td>
</tr>
<tr class="row-odd"><td>&lt;?name&gt;</td>
<td>property</td>
<td>evaluates to the property name</td>
</tr>
<tr class="row-even"><td>&lt;?name:map <em>name</em>&gt;</td>
<td>feature</td>
<td>uses the map <em>name</em> to map the feature type name to a value</td>
</tr>
<tr class="row-odd"><td>&lt;?name:map <em>name</em>&gt;</td>
<td>property</td>
<td>uses the map <em>name</em> to map the property name to a value</td>
</tr>
<tr class="row-even"><td>&lt;?value&gt;</td>
<td>property</td>
<td>evaluates to the property&#8217;s value</td>
</tr>
<tr class="row-odd"><td>&lt;?value:map <em>name</em>&gt;</td>
<td>property</td>
<td>uses the map <em>name</em> to map the property&#8217;s value to another value</td>
</tr>
<tr class="row-even"><td>&lt;?index&gt;</td>
<td>feature</td>
<td>evaluates to the index of the feature (in the list of matches from the previous template call)</td>
</tr>
<tr class="row-odd"><td>&lt;?index&gt;</td>
<td>property</td>
<td>evaluates to the index of the property (in the list of matches from the previous template call)</td>
</tr>
<tr class="row-even"><td>&lt;?gmlid&gt;</td>
<td>feature</td>
<td>evaluates to the feature&#8217;s gml:id</td>
</tr>
<tr class="row-odd"><td>&lt;?odd:<em>name</em>&gt;</td>
<td>feature</td>
<td>calls the <em>name</em> template if the index of the current feature is odd</td>
</tr>
<tr class="row-even"><td>&lt;?odd:<em>name</em>&gt;</td>
<td>property</td>
<td>calls the <em>name</em> template if the index of the current property is odd</td>
</tr>
<tr class="row-odd"><td>&lt;?even:<em>name</em>&gt;</td>
<td>feature</td>
<td>calls the <em>name</em> template if the index of the current feature is even</td>
</tr>
<tr class="row-even"><td>&lt;?even:<em>name</em>&gt;</td>
<td>property</td>
<td>calls the <em>name</em> template if the index of the current property is even</td>
</tr>
<tr class="row-odd"><td>&lt;?link:<em>prefix</em>:&gt;</td>
<td>property</td>
<td>if the value of the property is not an absolute link, the prefix is prepended</td>
</tr>
<tr class="row-even"><td>&lt;?link:<em>prefix</em>:<em>text</em>&gt;</td>
<td>property</td>
<td>the text of the link will be <em>text</em> instead of the link address</td>
</tr>
</tbody>
</table>
<p>The selector for properties and features is a kind of pattern matching on the object&#8217;s name.</p>
<table border="1" class="docutils">
<colgroup>
<col width="31%" />
<col width="69%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Selector</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>*</td>
<td>matches all objects</td>
</tr>
<tr class="row-odd"><td>* <em>text</em></td>
<td>matches all objects with names ending in <em>text</em></td>
</tr>
<tr class="row-even"><td><em>text</em> *</td>
<td>matches all objects with names starting with <em>text</em></td>
</tr>
<tr class="row-odd"><td>not(<em>selector</em>)</td>
<td>matches all objects not matching the selector <em>selector</em></td>
</tr>
<tr class="row-even"><td><em>selector1</em>, <em>selector2</em></td>
<td>matches all objects matching <em>selector1</em> and <em>selector2</em></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="extended-capabilities">
<h3>5.2.7. Extended capabilities<a class="headerlink" href="#extended-capabilities" title="Permalink to this headline">¶</a></h3>
<p>Important for applications like INSPIRE, it is often desirable to include predefined blocks of XML in the extended capabilities section of the WMS&#8217; capabilities output. This can be achieved simply by adding these blocks to the extended capabilities element of the configuration:</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;ExtendedCapabilities&gt;</span>
  <span class="nt">&lt;MyCustomOutput</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.custom.org/output&quot;</span><span class="nt">&gt;</span>
    ...
  <span class="nt">&lt;/MyCustomOutput&gt;</span>
<span class="nt">&lt;/ExtendedCapabilities&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="vendor-specific-parameters">
<h3>5.2.8. Vendor specific parameters<a class="headerlink" href="#vendor-specific-parameters" title="Permalink to this headline">¶</a></h3>
<p>The deegree WMS supports a number of vendor specific parameters. Some parameters are supported on a per layer basis while some are applied to the whole request. Most of the parameters correspond to the layer options above.</p>
<p>The parameters which are supported on a per layer basis can be used to set an option globally, eg. ...&amp;REQUEST=GetMap&amp;ANTIALIAS=BOTH&amp;..., or for each layer separately (using a comma separated list): ...&amp;REQUEST=GetMap&amp;ANTIALIAS=BOTH,TEXT,NONE&amp;LAYERS=layer1,layer2,layer3&amp;... Most of the layer options have a corresponding parameter with a similar name: ANTIALIAS, INTERPOLATION, QUALITY and MAX_FEATURES. The feature info radius can currently not be set dynamically.</p>
<p>The PIXELSIZE parameter can be used to dynamically adjust the resolution of the resulting image. The default is the WMS default of 0.28 mm. So to achieve a double resolution, you can double the WIDTH/HEIGHT parameter values and set the PIXELSIZE parameter to 0.14.</p>
<p>Using the QUERYBOXSIZE parameter you can include features when rendering that would normally not intersect the envelope specified in the BBOX parameter. That can be useful if you have labels at point symbols out of the envelope which would be rendered partly inside the map. Normal GetMap behaviour will exclude such a label. With the QUERYBOXSIZE parameter you can specify a factor by which to enlarge the original bounding box, which is used solely for querying the data store (the actual extent returned will not be changed!). Use values like 1.1 to enlarge the envelope by 5% in each direction (this would be 10% in total).</p>
</div>
</div>
<div class="section" id="web-map-tile-service-wmts">
<span id="anchor-configuration-wmts"></span><h2>5.3. Web Map Tile Service (WMTS)<a class="headerlink" href="#web-map-tile-service-wmts" title="Permalink to this headline">¶</a></h2>
<p>In deegree terminology, a deegree WMTS provides access to tiles stored in tile stores. The WMTS is configured using so-called <em>themes</em>. A theme can be thought of as a collection of layers, organized in a tree structure.</p>
<div class="figure" style="width: 80%">
<a class="reference external image-reference" href="_images/workspace-wmts.png"><img alt="_images/workspace-wmts.png" src="_images/workspace-wmts.png" style="width: 80%;" /></a>
<p class="caption">A WMTS resource is connected to any number of theme resources (with tile layers)</p>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">In order to fully understand deegree WMTS configuration, you will have to learn configuration of other workspace aspects as well. Chapter <a class="reference internal" href="tilestores.html#anchor-configuration-tilestore"><em>Tile stores</em></a> describes the configuration of tile data access. Chapter <a class="reference internal" href="layers.html#anchor-configuration-layers"><em>Map layers</em></a> describes the configuration of layers (only tile layers are usable for the WMTS). Chapter <a class="reference internal" href="themes.html#anchor-configuration-themes"><em>Map themes</em></a> describes how to create a theme from layers.</p>
</div>
<div class="section" id="id2">
<h3>5.3.1. Minimal example<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p>The only mandatory section is <tt class="docutils literal"><span class="pre">ServiceConfiguration</span></tt> (which can be empty), therefore a minimal WMTS configuration example looks like this:</p>
<div class="topic">
<p class="topic-title first">WMTS config example 1: Minimal configuration</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;deegreeWMTS</span> <span class="na">configVersion=</span><span class="s">&quot;3.2.0&quot;</span>
  <span class="na">xmlns=</span><span class="s">&quot;http://www.deegree.org/services/wmts&quot;</span>
  <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
  <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://www.deegree.org/services/wmts</span>
<span class="s">  http://schemas.deegree.org/services/wmts/3.2.0/wmts.xsd&quot;</span><span class="nt">&gt;</span>

  <span class="nt">&lt;ServiceConfiguration</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;/deegreeWMTS&gt;</span>
</pre></div>
</div>
</div>
<p>This will create a deegree WMTS resource that connects to all configured themes of the workspace.</p>
</div>
<div class="section" id="id3">
<h3>5.3.2. More complex example<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<p>A more complex configuration that restricts the offered themes looks like this:</p>
<div class="topic">
<p class="topic-title first">WMTS config example 2: More complex configuration</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;deegreeWMTS</span> <span class="na">configVersion=</span><span class="s">&quot;3.2.0&quot;</span>
  <span class="na">xmlns=</span><span class="s">&quot;http://www.deegree.org/services/wmts&quot;</span>
  <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
  <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://www.deegree.org/services/wmts</span>
<span class="s">  http://schemas.deegree.org/services/wmts/3.2.0/wmts.xsd&quot;</span><span class="nt">&gt;</span>

  <span class="nt">&lt;ServiceConfiguration&gt;</span>
    <span class="nt">&lt;ThemeId&gt;</span>water<span class="nt">&lt;/ThemeId&gt;</span>
    <span class="nt">&lt;ThemeId&gt;</span>roads<span class="nt">&lt;/ThemeId&gt;</span>
  <span class="nt">&lt;/ServiceConfiguration&gt;</span>

<span class="nt">&lt;/deegreeWMTS&gt;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id4">
<h3>5.3.3. Configuration overview<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<p>The deegree WMTS config file format is defined by schema file <a class="reference external" href="http://schemas.deegree.org/services/wmts/3.2.0/wmts.xsd">http://schemas.deegree.org/services/wmts/3.2.0/wmts.xsd</a>. The root element is <tt class="docutils literal"><span class="pre">deegreeWMTS</span></tt> and the config attribute must be <tt class="docutils literal"><span class="pre">3.2.0</span></tt>.</p>
<p>The following table lists all available configuration options. When specifying them, their order must be respected.</p>
<table border="1" class="docutils">
<colgroup>
<col width="20%" />
<col width="11%" />
<col width="7%" />
<col width="61%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Option</th>
<th class="head">Cardinality</th>
<th class="head">Value</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>MetadataURLTemplate</td>
<td>0..1</td>
<td>String</td>
<td>Template for generating URLs to layer metadata</td>
</tr>
<tr class="row-odd"><td>ThemeId</td>
<td>0..n</td>
<td>String</td>
<td>Limits themes to use</td>
</tr>
</tbody>
</table>
<p>Below the <tt class="docutils literal"><span class="pre">ServiceConfiguration</span></tt> section you can specify custom featureinfo format handlers:</p>
<p>Have a look at section <a class="reference internal" href="#anchor-featureinfo-configuration"><em>Custom feature info formats</em></a> (in the WMS chapter) to see how custom featureinfo formats are configured. Take note that the GetFeatureInfo operation is currently only supported for remote WMS tile store backends.</p>
</div>
</div>
<div class="section" id="catalogue-service-for-the-web-csw">
<span id="anchor-configuration-csw"></span><h2>5.4. Catalogue Service for the Web (CSW)<a class="headerlink" href="#catalogue-service-for-the-web-csw" title="Permalink to this headline">¶</a></h2>
<p>In deegree terminology, a deegree CSW provides access to metadata records stored in a metadata store. If the metadata store is transaction-capable, CSW transactions can be used to modify the stored records.</p>
<div class="figure" style="width: 80%">
<a class="reference external image-reference" href="_images/workspace-csw.png"><img alt="_images/workspace-csw.png" src="_images/workspace-csw.png" style="width: 80%;" /></a>
<p class="caption">A CSW resource is connected to exactly one metadata store resource</p>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">In order to fully understand deegree CSW configuration, you will have to learn configuration of other workspace aspects as well. Chapter <a class="reference internal" href="metadatastores.html#anchor-configuration-metadatastore"><em>Metadata stores</em></a> describes the configuration of metadatastores.</p>
</div>
<div class="section" id="id5">
<h3>5.4.1. Minimal example<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<p>There is no mandatory element, therefore a minimal CSW configuration example looks like this:</p>
<div class="topic">
<p class="topic-title first">CSW config example 1: Minimal configuration</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;deegreeCSW</span> <span class="na">configVersion=</span><span class="s">&quot;3.2.0&quot;</span>
  <span class="na">xmlns=</span><span class="s">&quot;http://www.deegree.org/services/csw&quot;</span> 
  <span class="na">xmlns:xlink=</span><span class="s">&quot;http://www.w3.org/1999/xlink&quot;</span>
  <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
  <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://www.deegree.org/services/csw </span>
<span class="s">  http://schemas.deegree.org/services/csw/3.2.0/csw_configuration.xsd&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;/deegreeCSW&gt;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id6">
<h3>5.4.2. Configuration overview<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
<p>The deegree CSW config file format is defined by schema file <a class="reference external" href="http://schemas.deegree.org/services/csw/3.2.0/csw_configuration.xsd">http://schemas.deegree.org/services/csw/3.2.0/csw_configuration.xsd</a>. The root element is <tt class="docutils literal"><span class="pre">deegreeCSW</span></tt> and the config attribute must be <tt class="docutils literal"><span class="pre">3.2.0</span></tt>.</p>
<p>The following table lists all available configuration options. When specifiying them, their order must be respected.</p>
<table border="1" class="docutils">
<colgroup>
<col width="18%" />
<col width="10%" />
<col width="6%" />
<col width="66%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Option</th>
<th class="head">Cardinality</th>
<th class="head">Value</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>SupportedVersions</td>
<td>0..1</td>
<td>String</td>
<td>Supported CSW Version (Default: 2.0.2)</td>
</tr>
<tr class="row-odd"><td>MaxMatches</td>
<td>0..1</td>
<td>Integer</td>
<td>Not negative number of matches (Default:0)</td>
</tr>
<tr class="row-even"><td>MetadataStoreId</td>
<td>0..1</td>
<td>String</td>
<td>Id of the meradatastoreId to use as backenend. By default the only configured store is used.</td>
</tr>
<tr class="row-odd"><td>EnableTransactions</td>
<td>0..1</td>
<td>Boolean</td>
<td>Enable transactions (CSW operations) default: disabled. (Default: false)</td>
</tr>
<tr class="row-even"><td>EnableInspireExtensions</td>
<td>0..1</td>
<td>&nbsp;</td>
<td>Enable the INSPIRE extensions, default: disabled</td>
</tr>
<tr class="row-odd"><td>ExtendedCapabilities</td>
<td>0..1</td>
<td>anyURI</td>
<td>Include referenced capabilities section.</td>
</tr>
<tr class="row-even"><td>ElementNames</td>
<td>0..1</td>
<td>&nbsp;</td>
<td>List of configured return profiles. See following xml snippet for detailed informations.</td>
</tr>
</tbody>
</table>
<blockquote>
<div><div class="highlight-xml"><div class="highlight"><pre>...
 <span class="nt">&lt;ElementNames&gt;</span>
   <span class="c">&lt;!-- Can contain multiuple sets of element names --&gt;</span>
   <span class="nt">&lt;ElementName&gt;</span>
     <span class="c">&lt;!-- name of this set. Used &lt;csw:ElementName&gt;Base&lt;/csw:ElementName&gt; </span>
<span class="c">          in a reqest to query this profile --&gt;</span>
     <span class="nt">&lt;name&gt;</span>Base<span class="nt">&lt;/name&gt;</span>
     <span class="c">&lt;!-- List of XPath elements to return. If an element node is specified </span>
<span class="c">          the complete node is returned --&gt;</span>
     <span class="nt">&lt;XPath&gt;</span>/gmd:MD_Metadata/gmd:language<span class="nt">&lt;/XPath&gt;</span>
     <span class="nt">&lt;XPath&gt;</span>/gmd:MD_Metadata/gmd:fileIdentifier<span class="nt">&lt;/XPath&gt;</span>
     <span class="nt">&lt;XPath&gt;</span>/gmd:MD_Metadata/gmd:hierarchyLevel<span class="nt">&lt;/XPath&gt;</span>
  <span class="nt">&lt;/ElementName&gt;</span>
  ...
 <span class="nt">&lt;ElementName&gt;</span>
...
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="extended-functionality">
<h3>5.4.3. Extended Functionality<a class="headerlink" href="#extended-functionality" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>deegree3 CSW (up to 3.2-pre11) supports JSON as additional output format. Use <em>outputFormat=&#8221;application/json&#8221;</em> in your GetRecords or GetRecordById Request to get the matching records in JSON.</li>
</ul>
</div>
</div>
<div class="section" id="web-processing-service-wps">
<span id="anchor-configuration-wps"></span><h2>5.5. Web Processing Service (WPS)<a class="headerlink" href="#web-processing-service-wps" title="Permalink to this headline">¶</a></h2>
<p>A deegree WPS allows the invocation of geospatial processes. The offered processes are determined by the attached process provider resources.</p>
<div class="figure" style="width: 90%">
<a class="reference external image-reference" href="_images/workspace-wps.png"><img alt="_images/workspace-wps.png" src="_images/workspace-wps.png" style="width: 90%;" /></a>
<p class="caption">Workspace components involved in a deegree WPS configuration</p>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">In order to fully master deegree WPS configuration, you will have to understand <a class="reference internal" href="processproviders.html#anchor-configuration-processproviders"><em>Process providers</em></a> as well.</p>
</div>
<div class="section" id="id7">
<h3>5.5.1. Minimal example<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h3>
<p>A minimal valid WPS configuration example looks like this:</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;deegreeWPS</span> <span class="na">configVersion=</span><span class="s">&quot;3.1.0&quot;</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.deegree.org/services/wps&quot;</span> <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
  <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://www.deegree.org/services/wps http://schemas.deegree.org/services/wps/3.1.0/wps_configuration.xsd&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;/deegreeWPS&gt;</span>
</pre></div>
</div>
<p>This will create a WPS resource with the following properties:</p>
<ul class="simple">
<li>All WPS protocol versions are enabled. Currently, this is only 1.0.0.</li>
<li>The WPS resource will attach to all process provider resources in the workspace.</li>
<li>Temporary files (e.g. for process results) are stored in the standard Java temp directory of the deegree webapp.</li>
<li>The last 100 process executions are tracked.</li>
<li>Memory buffers (e.g. for inline XML inputs) are limited to 1 MB each. If this limit is exceeded, buffering is switched to use a file in the storage directory.</li>
</ul>
</div>
<div class="section" id="complex-example">
<h3>5.5.2. Complex example<a class="headerlink" href="#complex-example" title="Permalink to this headline">¶</a></h3>
<p>A more complex configuration example looks like this:</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;deegreeWPS</span> <span class="na">configVersion=</span><span class="s">&quot;3.1.0&quot;</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.deegree.org/services/wps&quot;</span> <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
  <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://www.deegree.org/services/wps http://schemas.deegree.org/services/wps/3.1.0/wps_configuration.xsd&quot;</span><span class="nt">&gt;</span>

  <span class="nt">&lt;SupportedVersions&gt;</span>
    <span class="nt">&lt;Version&gt;</span>1.0.0<span class="nt">&lt;/Version&gt;</span>
  <span class="nt">&lt;/SupportedVersions&gt;</span>

  <span class="nt">&lt;DefaultExecutionManager&gt;</span>
    <span class="nt">&lt;StorageDir&gt;</span>../var/wps/<span class="nt">&lt;/StorageDir&gt;</span>
    <span class="nt">&lt;TrackedExecutions&gt;</span>1000<span class="nt">&lt;/TrackedExecutions&gt;</span>
    <span class="nt">&lt;InputDiskSwitchLimit&gt;</span>1048576<span class="nt">&lt;/InputDiskSwitchLimit&gt;</span>
  <span class="nt">&lt;/DefaultExecutionManager&gt;</span>

<span class="nt">&lt;/deegreeWPS&gt;</span>
</pre></div>
</div>
<p>This will create a WPS resource with the following properties:</p>
<ul class="simple">
<li>Enabled WPS protocol versions: 1.0.0</li>
<li>The WPS resource will attach to all process provider resources in the workspace.</li>
<li>Storage directory for temporary files (e.g. for process results) is <tt class="docutils literal"><span class="pre">/var/wps</span></tt> inside the workspace.</li>
<li>The last 1000 process executions will be tracked.</li>
<li>Memory buffers (e.g. for inline XML inputs) are limited to 1 MB each. If this limit is exceeded, buffering is switched to use a file in the storage directory.</li>
</ul>
</div>
<div class="section" id="id8">
<h3>5.5.3. Configuration overview<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h3>
<p>The deegree WPS config file format is defined by schema file <a class="reference external" href="http://schemas.deegree.org/services/wps/3.1.0/wps_configuration.xsd">http://schemas.deegree.org/services/wps/3.1.0/wps_configuration.xsd</a>. The root element is <tt class="docutils literal"><span class="pre">deegreeWPS</span></tt> and the config attribute must be <tt class="docutils literal"><span class="pre">3.1.0</span></tt>. The following table lists all available configuration options (complex ones contain nested options themselves). When specifiying them, their order must be respected.</p>
<table border="1" class="docutils">
<colgroup>
<col width="27%" />
<col width="14%" />
<col width="10%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Option</th>
<th class="head">Cardinality</th>
<th class="head">Value</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>SupportedVersions</td>
<td>0..1</td>
<td>Complex</td>
<td>Activated OGC protocol versions, default: all</td>
</tr>
<tr class="row-odd"><td>DefaultExecutionManager</td>
<td>0..1</td>
<td>Complex</td>
<td>Settings for tracking process executions</td>
</tr>
</tbody>
</table>
<p>The remainder of this section describes these options and their sub-options in detail.</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">SupportedVersions</span></tt>: By default, all implemented WMS protocol versions are activated. Currently, this is just 1.0.0 anyway. Alternatively you can control offered WPS protocol versions using the element <tt class="docutils literal"><span class="pre">SupportedVersions</span></tt>. This element allows the child element <tt class="docutils literal"><span class="pre">&lt;Version&gt;1.0.0&lt;/Version&gt;</span></tt> for now.</li>
</ul>
</div>
<div class="section" id="defaultexecutionmanager-section">
<h3>5.5.4. DefaultExecutionManager section<a class="headerlink" href="#defaultexecutionmanager-section" title="Permalink to this headline">¶</a></h3>
<p>This section controls aspects that are related to temporary storage (for input and output parameter values) during the execution of processes. The <tt class="docutils literal"><span class="pre">DefaultExecutionManager</span></tt> option has the following sub-options:</p>
<table border="1" class="docutils">
<colgroup>
<col width="18%" />
<col width="11%" />
<col width="7%" />
<col width="64%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Option</th>
<th class="head">Cardinality</th>
<th class="head">Value</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>StorageDir</td>
<td>0..1</td>
<td>String</td>
<td>Directory for storing execution-related data, default: Java tempdir</td>
</tr>
<tr class="row-odd"><td>TrackedExecutions</td>
<td>0..1</td>
<td>Integer</td>
<td>Number of executions to track, default: 100</td>
</tr>
<tr class="row-even"><td>InputDiskSwitchLimit</td>
<td>0..1</td>
<td>Integer</td>
<td>Limit in bytes, before a ComplexInputInput is written to disk, default: 1 MiB</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="metadata">
<span id="anchor-configuration-service-metadata"></span><h2>5.6. Metadata<a class="headerlink" href="#metadata" title="Permalink to this headline">¶</a></h2>
<p>This section describes the configuration for the different types of metadata that a service reports in the <tt class="docutils literal"><span class="pre">GetCapabilities</span></tt> response. These options don&#8217;t affect the data that the service offers or the behaviour of the service. It merely changes the descriptive metadata that the service reports.</p>
<p>In order to configure the metadata for a web service instance <tt class="docutils literal"><span class="pre">xyz</span></tt>, create a corresponding <tt class="docutils literal"><span class="pre">xyz_metadata.xml</span></tt> file in the <tt class="docutils literal"><span class="pre">services</span></tt> directory of the workspace. The actual service type does not matter, the configuration works for all types of service alike.</p>
<div class="topic">
<p class="topic-title first">Example for <tt class="docutils literal"><span class="pre">deegreeServicesMetadata</span></tt></p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;deegreeServicesMetadata</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.deegree.org/services/metadata&quot;</span>
  <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> <span class="na">configVersion=</span><span class="s">&quot;3.2.0&quot;</span>
  <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://www.deegree.org/services/metadata http://schemas.deegree.org/services/metadata/3.2.0/metadata.xsd&quot;</span><span class="nt">&gt;</span>

  <span class="nt">&lt;ServiceIdentification&gt;</span>
    <span class="nt">&lt;Title&gt;</span>INSPIRE Addresses<span class="nt">&lt;/Title&gt;</span>
    <span class="nt">&lt;Abstract&gt;</span>Direct Access Download Service for INSPIRE Addresses<span class="nt">&lt;/Abstract&gt;</span>
  <span class="nt">&lt;/ServiceIdentification&gt;</span>

  <span class="nt">&lt;ServiceProvider&gt;</span>
    <span class="nt">&lt;ProviderName&gt;</span>The deegree project<span class="nt">&lt;/ProviderName&gt;</span>
    <span class="nt">&lt;ProviderSite&gt;</span>http://www.deegree.org<span class="nt">&lt;/ProviderSite&gt;</span>
    <span class="nt">&lt;ServiceContact&gt;</span>
      <span class="nt">&lt;IndividualName&gt;</span>Markus Schneider<span class="nt">&lt;/IndividualName&gt;</span>
      <span class="nt">&lt;PositionName&gt;</span>deegree TMC<span class="nt">&lt;/PositionName&gt;</span>
      <span class="nt">&lt;Phone&gt;</span>0228/18496-0<span class="nt">&lt;/Phone&gt;</span>
      <span class="nt">&lt;Facsimile&gt;</span>0228/18496-29<span class="nt">&lt;/Facsimile&gt;</span>
      <span class="nt">&lt;ElectronicMailAddress&gt;</span>info@lat-lon.de<span class="nt">&lt;/ElectronicMailAddress&gt;</span>
      <span class="nt">&lt;Address&gt;</span>
        <span class="nt">&lt;DeliveryPoint&gt;</span>Aennchenstr. 19<span class="nt">&lt;/DeliveryPoint&gt;</span>
        <span class="nt">&lt;City&gt;</span>Bonn<span class="nt">&lt;/City&gt;</span>
        <span class="nt">&lt;AdministrativeArea&gt;</span>NRW<span class="nt">&lt;/AdministrativeArea&gt;</span>
        <span class="nt">&lt;PostalCode&gt;</span>53177<span class="nt">&lt;/PostalCode&gt;</span>
        <span class="nt">&lt;Country&gt;</span>Germany<span class="nt">&lt;/Country&gt;</span>
      <span class="nt">&lt;/Address&gt;</span>
      <span class="nt">&lt;OnlineResource&gt;</span>http://www.deegree.org<span class="nt">&lt;/OnlineResource&gt;</span>
      <span class="nt">&lt;HoursOfService&gt;</span>24x7<span class="nt">&lt;/HoursOfService&gt;</span>
      <span class="nt">&lt;ContactInstructions&gt;</span>Do not hesitate to call<span class="nt">&lt;/ContactInstructions&gt;</span>
      <span class="nt">&lt;Role&gt;</span>PointOfContact<span class="nt">&lt;/Role&gt;</span>
    <span class="nt">&lt;/ServiceContact&gt;</span>
  <span class="nt">&lt;/ServiceProvider&gt;</span>

  <span class="nt">&lt;DatasetMetadata&gt;</span>
    <span class="nt">&lt;MetadataUrlTemplate&gt;</span>http://www.nationaalgeoregister.nl/geonetwork/srv/nl/csw?service=CSW<span class="ni">&amp;amp;</span>request=GetRecordById<span class="ni">&amp;amp;</span>version=2.0.2<span class="ni">&amp;amp;</span>id=${metadataSetId}<span class="nt">&lt;/MetadataUrlTemplate&gt;</span>
    <span class="nt">&lt;Dataset&gt;</span>
      <span class="nt">&lt;Name</span> <span class="na">xmlns:ad=</span><span class="s">&quot;urn:x-inspire:specification:gmlas:Addresses:3.0&quot;</span><span class="nt">&gt;</span>ad:Address<span class="nt">&lt;/Name&gt;</span>
      <span class="nt">&lt;Title&gt;</span>ad:Address<span class="nt">&lt;/Title&gt;</span>
      <span class="nt">&lt;Abstract&gt;</span>Harmonized INSPIRE Addresses (Annex I)<span class="nt">&lt;/Abstract&gt;</span>
      <span class="nt">&lt;MetadataSetId&gt;</span>beefcafe-beef-cafe-beef-cafebeefcaf<span class="nt">&lt;/MetadataSetId&gt;</span>
    <span class="nt">&lt;/Dataset&gt;</span>
  <span class="nt">&lt;/DatasetMetadata&gt;</span>

  <span class="nt">&lt;ExtendedCapabilities</span> <span class="na">protocolVersions=</span><span class="s">&quot;2.0.0&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;inspire_dls:ExtendedCapabilities</span> <span class="na">xmlns:inspire_dls=</span><span class="s">&quot;http://inspire.ec.europa.eu/schemas/inspire_dls/1.0&quot;</span>
      <span class="na">xmlns:inspire_common=</span><span class="s">&quot;http://inspire.ec.europa.eu/schemas/common/1.0&quot;</span>
      <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://inspire.ec.europa.eu/schemas/common/1.0 http://inspire.ec.europa.eu/schemas/common/1.0/common.xsd http://inspire.ec.europa.eu/schemas/inspire_dls/1.0 http://inspire.ec.europa.eu/schemas/inspire_dls/1.0/inspire_dls.xsd&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;inspire_common:MetadataUrl&gt;</span>
        <span class="nt">&lt;inspire_common:URL&gt;</span>http://www.nationaalgeoregister.nl/geonetwork/srv/nl/csw?service=CSW<span class="ni">&amp;amp;</span>request=GetRecordById<span class="ni">&amp;amp;</span>version=2.0.2<span class="ni">&amp;amp;</span>id=eea97fc0-8291-11e1-afa6-0800200c9a66<span class="nt">&lt;/inspire_common:URL&gt;</span>
        <span class="nt">&lt;inspire_common:MediaType&gt;</span>application/vnd.iso.19139+xml<span class="nt">&lt;/inspire_common:MediaType&gt;</span>
      <span class="nt">&lt;/inspire_common:MetadataUrl&gt;</span>
      <span class="nt">&lt;inspire_common:SupportedLanguages&gt;</span>
        <span class="nt">&lt;inspire_common:DefaultLanguage&gt;</span>
          <span class="nt">&lt;inspire_common:Language&gt;</span>ger<span class="nt">&lt;/inspire_common:Language&gt;</span>
        <span class="nt">&lt;/inspire_common:DefaultLanguage&gt;</span>
      <span class="nt">&lt;/inspire_common:SupportedLanguages&gt;</span>
      <span class="nt">&lt;inspire_common:ResponseLanguage&gt;</span>
        <span class="nt">&lt;inspire_common:Language&gt;</span>ger<span class="nt">&lt;/inspire_common:Language&gt;</span>
      <span class="nt">&lt;/inspire_common:ResponseLanguage&gt;</span>
      <span class="nt">&lt;inspire_dls:SpatialDataSetIdentifier&gt;</span>
        <span class="nt">&lt;inspire_common:Code&gt;</span>eea97fc0-8291-11e1-afa6-0800200c9a66<span class="nt">&lt;/inspire_common:Code&gt;</span>
      <span class="nt">&lt;/inspire_dls:SpatialDataSetIdentifier&gt;</span>
    <span class="nt">&lt;/inspire_dls:ExtendedCapabilities&gt;</span>
  <span class="nt">&lt;/ExtendedCapabilities&gt;</span>

<span class="nt">&lt;/deegreeServicesMetadata&gt;</span>
</pre></div>
</div>
</div>
<p>The metadata config file format is defined by schema file <a class="reference external" href="http://schemas.deegree.org/services/metadata/3.2.0/metadata.xsd">http://schemas.deegree.org/services/metadata/3.2.0/metadata.xsd</a>. The root element is <tt class="docutils literal"><span class="pre">deegreeServicesMetadata</span></tt> and the config attribute must be <tt class="docutils literal"><span class="pre">3.2.0</span></tt>. The following table lists all available configuration options (complex ones contain nested options themselves). When specifiying them, their order must be respected.</p>
<table border="1" class="docutils">
<colgroup>
<col width="22%" />
<col width="12%" />
<col width="8%" />
<col width="58%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Option</th>
<th class="head">Cardinality</th>
<th class="head">Value</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>ServiceIdentification</td>
<td>1..1</td>
<td>Complex</td>
<td>Metadata that describes the service</td>
</tr>
<tr class="row-odd"><td>ServiceProvider</td>
<td>1..1</td>
<td>Complex</td>
<td>Metadata that describes the provider of the service</td>
</tr>
<tr class="row-even"><td>DatasetMetadata</td>
<td>0..1</td>
<td>Complex</td>
<td>Metadata on the datasets provided by the service</td>
</tr>
<tr class="row-odd"><td>ExtendedCapabilities</td>
<td>0..n</td>
<td>Complex</td>
<td>Extended Metadata reported in OperationsMetadata section</td>
</tr>
</tbody>
</table>
<p>The remainder of this section describes these options and their sub-options in detail.</p>
<div class="section" id="service-identification">
<h3>5.6.1. Service identification<a class="headerlink" href="#service-identification" title="Permalink to this headline">¶</a></h3>
<p>The <tt class="docutils literal"><span class="pre">ServiceIdentification</span></tt> option has the following sub-options:</p>
<table border="1" class="docutils">
<colgroup>
<col width="18%" />
<col width="11%" />
<col width="7%" />
<col width="64%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Option</th>
<th class="head">Cardinality</th>
<th class="head">Value</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Title</td>
<td>0..n</td>
<td>String</td>
<td>Title of the service</td>
</tr>
<tr class="row-odd"><td>Abstract</td>
<td>0..n</td>
<td>String</td>
<td>Abstract</td>
</tr>
<tr class="row-even"><td>Keywords</td>
<td>0..n</td>
<td>Complex</td>
<td>Keywords that describe the service</td>
</tr>
<tr class="row-odd"><td>Fees</td>
<td>0..1</td>
<td>String</td>
<td>Fees that apply for using this service</td>
</tr>
<tr class="row-even"><td>AccessConstraints</td>
<td>0..n</td>
<td>String</td>
<td>Access constraints for this service</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="service-provider">
<h3>5.6.2. Service provider<a class="headerlink" href="#service-provider" title="Permalink to this headline">¶</a></h3>
<p>The <tt class="docutils literal"><span class="pre">ServiceProvider</span></tt> option has the following sub-options:</p>
<table border="1" class="docutils">
<colgroup>
<col width="21%" />
<col width="17%" />
<col width="12%" />
<col width="49%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Option</th>
<th class="head">Cardinality</th>
<th class="head">Value</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>ProviderName</td>
<td>0..1</td>
<td>String</td>
<td>Name of the service provider</td>
</tr>
<tr class="row-odd"><td>ProviderSite</td>
<td>0..1</td>
<td>String</td>
<td>Website of the service provider</td>
</tr>
<tr class="row-even"><td>ServiceContact</td>
<td>0..1</td>
<td>Complex</td>
<td>Contact information</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="dataset-metadata">
<h3>5.6.3. Dataset metadata<a class="headerlink" href="#dataset-metadata" title="Permalink to this headline">¶</a></h3>
<p>This type of metadata is attached to the datasets that a service offers (e.g. layers for the WMS or feature types for the WFS). The services themselves may have specific mechanisms to override this metadata, so make sure to have a look at the appropriate service sections. However, some metadata configuration can be done right here.</p>
<p>To start with, you&#8217;ll need to add a <tt class="docutils literal"><span class="pre">DatasetMetadata</span></tt> container element:</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;DatasetMetadata&gt;</span>
...
<span class="nt">&lt;/DatasetMetadata&gt;</span>
</pre></div>
</div>
<p>Apart from the descriptive metadata (title, abstract etc.) for each dataset, you can also configure <a href="#id9"><span class="problematic" id="id10">``</span></a>MetadataURL``s, external metadata links and metadata as well as external metadata IDs.</p>
<p>For general <tt class="docutils literal"><span class="pre">MetadataURL</span></tt> configuration, you can configure the element <tt class="docutils literal"><span class="pre">MetadataUrlTemplate</span></tt>. Its content can be any URL, which may contain the pattern <tt class="docutils literal"><span class="pre">${metadataSetId}</span></tt>. For each dataset (layer, feature type) the service will output a <tt class="docutils literal"><span class="pre">MetadataURL</span></tt> based on that pattern, if a <tt class="docutils literal"><span class="pre">MetadataSetId</span></tt> has been configured for that dataset (see below). The template is optional, if omitted, no <tt class="docutils literal"><span class="pre">MetadataURL</span></tt> will be produced.</p>
<p>Configuration for the template looks like this:</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;DatasetMetadata&gt;</span>
  <span class="nt">&lt;MetadataUrlTemplate&gt;</span>http://some.url.de/csw?request=GetRecordById<span class="ni">&amp;amp;</span>service=CSW<span class="ni">&amp;amp;</span>version=2.0.2<span class="ni">&amp;amp;</span>outputschema=http://www.isotc211.org/2005/gmd<span class="ni">&amp;amp;</span>elementsetname=full<span class="ni">&amp;amp;</span>id=${metadataSetId}<span class="nt">&lt;/MetadataUrlTemplate&gt;</span>
...
<span class="nt">&lt;/DatasetMetadata&gt;</span>
</pre></div>
</div>
<p>You can also configure <tt class="docutils literal"><span class="pre">ExternalMetadataAuthority</span></tt> elements, which are currently only used by the WMS. You can define multiple authorities, with the authority URL as text content and a unique <tt class="docutils literal"><span class="pre">name</span></tt> attribute. For each dataset you can define an ID for an authority by refering to that name. This will generate an <tt class="docutils literal"><span class="pre">AuthorityURL</span></tt> and <tt class="docutils literal"><span class="pre">Identifier</span></tt> pair in WMS capabilities documents (version 1.3.0 only).</p>
<p>Configuration for an external authority looks like this:</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;DatasetMetadata&gt;</span>
  <span class="nt">&lt;ExternalMetadataAuthority</span> <span class="na">name=</span><span class="s">&quot;myorg&quot;</span><span class="nt">&gt;</span>http://www.myauthority.org/metadataregistry/<span class="nt">&lt;/ExternalMetadataAuthority&gt;</span>
...
<span class="nt">&lt;/DatasetMetadata&gt;</span>
</pre></div>
</div>
<p>Now follows the list of the actual dataset metadata. You can add as many as you need:</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;DatasetMetadata&gt;</span>
  <span class="nt">&lt;MetadataUrlTemplate&gt;</span>...<span class="nt">&lt;/MetadataUrlTemplate&gt;</span>
  ...
  <span class="nt">&lt;Dataset&gt;</span>
  ...
  <span class="nt">&lt;/Dataset&gt;</span>
  <span class="nt">&lt;Dataset&gt;</span>
  ...
  <span class="nt">&lt;/Dataset&gt;</span>
  ...
<span class="nt">&lt;/DatasetMetadata&gt;</span>
</pre></div>
</div>
<p>For each dataset, you can configure the metadata as outlined in the following table:</p>
<table border="1" class="docutils">
<colgroup>
<col width="17%" />
<col width="9%" />
<col width="10%" />
<col width="64%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Option</th>
<th class="head">Cardinality</th>
<th class="head">Value</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Name</td>
<td>1</td>
<td>String/QName</td>
<td>the layer/feature type name you refer to</td>
</tr>
<tr class="row-odd"><td>Title</td>
<td>0..n</td>
<td>String</td>
<td>can be multilingual by using the <tt class="docutils literal"><span class="pre">lang</span></tt> attribute</td>
</tr>
<tr class="row-even"><td>Abstract</td>
<td>0..n</td>
<td>String</td>
<td>can be multilingual by using the <tt class="docutils literal"><span class="pre">lang</span></tt> attribute</td>
</tr>
<tr class="row-odd"><td>MetadataSetId</td>
<td>0..1</td>
<td>String</td>
<td>is used to generate <tt class="docutils literal"><span class="pre">MetadataURL</span></tt> s, see above</td>
</tr>
<tr class="row-even"><td>ExternalMetadataSetId</td>
<td>0..n</td>
<td>String</td>
<td>is used to generate <tt class="docutils literal"><span class="pre">AuthorityURL</span></tt> s and <tt class="docutils literal"><span class="pre">Identifier</span></tt> s for WMS, see above. Refer to an
authority using the <tt class="docutils literal"><span class="pre">authority</span></tt> attribute.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="id11">
<h3>5.6.4. Extended capabilities<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h3>
<p>Extended capabilities are generic metadata sections below the <tt class="docutils literal"><span class="pre">OperationsMetadata</span></tt> element in the <tt class="docutils literal"><span class="pre">GetCapabilities</span></tt> response. They are not defined by the OGC service specifications, but by additional guidance documents, such as the INSPIRE Network Service TGs. deegree treats this section as a generic XML element and includes it in the output. If your service supports multiple protocol versions (e.g. a WFS that supports 1.1.0 and 2.0.0), you may include multiple <tt class="docutils literal"><span class="pre">ExtendedCapabilities</span></tt> elements in the metadata configuration and use attribute <tt class="docutils literal"><span class="pre">protocolVersions</span></tt> to indicate the version that you want to define the extended capabilities for.</p>
</div>
</div>
<div class="section" id="service-controller">
<h2>5.7. Service controller<a class="headerlink" href="#service-controller" title="Permalink to this headline">¶</a></h2>
<p>The controller configuration is used to configure various global aspects that affect all services.</p>
<p>Since it&#8217;s a global configuration file for all services, it&#8217;s called <tt class="docutils literal"><span class="pre">main.xml</span></tt>, and located in the <tt class="docutils literal"><span class="pre">services</span></tt> directory. All of the options are optional, and you can also omit the file completely.</p>
<p>An empty example file looks like follows:</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="cp">&lt;?xml version=&#39;1.0&#39;?&gt;</span>
<span class="nt">&lt;deegreeServiceController</span> <span class="na">xmlns=</span><span class="s">&#39;http://www.deegree.org/services/controller&#39;</span> <span class="na">configVersion=</span><span class="s">&#39;3.4.0&#39;</span><span class="nt">&gt;</span>
<span class="nt">&lt;/deegreeServiceController&gt;</span>
</pre></div>
</div>
<p>The following table lists all available configuration options. When specifiying them, their order must be respected.</p>
<table border="1" class="docutils">
<colgroup>
<col width="29%" />
<col width="14%" />
<col width="9%" />
<col width="47%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Option</th>
<th class="head">Cardinality</th>
<th class="head">Value</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>ReportedUrls</td>
<td>0..1</td>
<td>Complex</td>
<td>Hardcode reported URLs in service responses</td>
</tr>
<tr class="row-odd"><td>PreventClassloaderLeaks</td>
<td>0..1</td>
<td>Boolean</td>
<td>TODO</td>
</tr>
<tr class="row-even"><td>RequestLogging</td>
<td>0..1</td>
<td>Complex</td>
<td>TODO</td>
</tr>
<tr class="row-odd"><td>ValidateResponses</td>
<td>0..1</td>
<td>Boolean</td>
<td>TODO</td>
</tr>
<tr class="row-even"><td>RequestTimeoutMilliseconds</td>
<td>0..n</td>
<td>Complex</td>
<td>Maximum request execution time</td>
</tr>
</tbody>
</table>
<p>The following sections describe the available options in detail.</p>
<div class="section" id="reported-urls">
<h3>5.7.1. Reported URLs<a class="headerlink" href="#reported-urls" title="Permalink to this headline">¶</a></h3>
<p>Some web service responses contain URLs that refer back to the service, for example in capabilities documents (responses to GetCapabilities requests). By default, deegree derives these URLs from the incoming request, so you don&#8217;t have to think about this, even when your server has multiple network interfaces or hostnames. However, sometimes it is required to override these URLs, for example when using deegree behind a proxy or load balancer.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">If you don&#8217;t have a proxy setup that requires it, don&#8217;t configure the reported URLs. In standard setups, the default behaviour works best.</p>
</div>
<p>To override the reported URLs, put a fragment like the following into the <tt class="docutils literal"><span class="pre">main.xml</span></tt>:</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;ReportedUrls&gt;</span>
  <span class="nt">&lt;Services&gt;</span>http://www.mygeoportal.com/ows<span class="nt">&lt;/Services&gt;</span>
  <span class="nt">&lt;Resources&gt;</span>http://www.mygeoportal.com/ows-resources<span class="nt">&lt;/Resources&gt;</span>
<span class="nt">&lt;/ReportedUrls&gt;</span>
</pre></div>
</div>
<p>For this example, deegree would report <tt class="docutils literal"><span class="pre">http://www.mygeoportal.com/ows</span></tt> as service endpoint URL in capabilities responses, regardless of the real connection details of the deegree server. If a specific service is contacted on the deegree server, for example via a request to <tt class="docutils literal"><span class="pre">http://realnameofdeegreemachine:8080/deegree-webservices/services/inspire-wfs-ad</span></tt>, deegree would report <tt class="docutils literal"><span class="pre">http://www.mygeoportal.com/ows/inspire-wfs-ad</span></tt>.</p>
<p>The URL configured by <tt class="docutils literal"><span class="pre">Resources</span></tt> relates to the reported URL of the <tt class="docutils literal"><span class="pre">resources</span></tt> servlet, which allows to access parts of the active deegree workspace via HTTP. Currently, this is only used in WFS DescribeFeatureType responses that access GML application schema directories.</p>
</div>
<div class="section" id="request-timeouts">
<h3>5.7.2. Request timeouts<a class="headerlink" href="#request-timeouts" title="Permalink to this headline">¶</a></h3>
<p>By default, the execution time of a request to a web service is not constrained. It depends on the complexity of the request and the configuration &#8211; it&#8217;s well possible to create a WMS configuration and a GetMap request that will require hours of processing time. Generally, it is the responsibility of the configuration creator to ensure that service requests will return in a reasonable time (e.g. by applying scale limitations in the layer configuration).</p>
<p>Nevertheless, it is sometimes desirable to enforce an execution time limit. This can be achieved by using the RequestTimeoutMilliseconds option:</p>
<div class="highlight-xml"><div class="highlight"><pre>...
  <span class="nt">&lt;RequestTimeoutMilliseconds</span> <span class="na">serviceId=</span><span class="s">&quot;wms1&quot;</span> <span class="na">request=</span><span class="s">&quot;GetMap&quot;</span><span class="nt">&gt;</span>1000<span class="nt">&lt;/RequestTimeoutMilliseconds&gt;</span>
  <span class="nt">&lt;RequestTimeoutMilliseconds</span> <span class="na">serviceId=</span><span class="s">&quot;wms2&quot;</span> <span class="na">request=</span><span class="s">&quot;GetMap&quot;</span><span class="nt">&gt;</span>2500<span class="nt">&lt;/RequestTimeoutMilliseconds&gt;</span>
...
</pre></div>
</div>
<p>This example enforces the following time-out behaviour:</p>
<ul class="simple">
<li>GetMap requests to WMS instance wms1 will be interrupted after an execution time of 1000 milliseconds</li>
<li>GetMap requests to WMS instance wms2 will be interrupted after an execution time of 2500 milliseconds</li>
</ul>
<p>Besides the time-out value in milliseconds, the following sub-options are supported by RequestTimeoutMilliseconds:</p>
<table border="1" class="docutils">
<colgroup>
<col width="17%" />
<col width="19%" />
<col width="13%" />
<col width="51%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Option</th>
<th class="head">Cardinality</th>
<th class="head">Value</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>&#64;serviceId</td>
<td>1</td>
<td>String</td>
<td>Resource identifier of the service</td>
</tr>
<tr class="row-odd"><td>&#64;request</td>
<td>1</td>
<td>String</td>
<td>Service request</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">A time-out value can be configured for any service type and request. However, a correct termination of requests requires that the relevant Java code is actually interruptible. So far, this has only been verified for GetMap requests to WMS based on feature layers.</p>
</div>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2013, The deegree project.<br/>
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.2.2.<br/>
    </p>
  </div>
</footer>
  </body>
</html>